<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Category: technology - lawilet&#039;s website</title><meta property="og:type" content="blog"><meta property="og:title" content="lawilet&#039;s website"><meta property="og:url" content="http://law-liet.com/"><meta property="og:site_name" content="lawilet&#039;s website"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://law-liet.com/img/og_image.png"><meta property="article:author" content="lawiet019"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://law-liet.com"},"headline":"lawilet's website","image":["http://law-liet.com/img/og_image.png"],"author":{"@type":"Person","name":"lawiet019"},"description":""}</script><link rel="icon" href="/img/favicon.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/favicon.png" alt="lawilet&#039;s website" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/lawiet019"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/categories">Categories</a></li><li class="is-active"><a href="#" aria-current="page">technology</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2022-04-10T02:39:00.000Z" title="2022-04-10T02:39:00.000Z">2022-04-09</time><span class="level-item"> lawiet019 </span><span class="level-item"><a class="link-muted" href="/categories/technology/">technology</a></span><span class="level-item">5 minutes read (About 699 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/04/09/Authentication-vs-Authorization-md/">Authentication_vs_Authorization.md</a></h1><div class="content"><h2 id="1-What-Is-Authentication"><a href="#1-What-Is-Authentication" class="headerlink" title="1.What Is Authentication"></a>1.What Is Authentication</h2><p>Authentication is the act of validating that users are whom they claim to be. This is the first step in any security process.<br>common implementation methods:</p>
<ul>
<li>What you know: Most commonly, this is a password. But it can also be an answer to a security question or a one-time pin that grants user access to just one session or transaction.</li>
<li>What you possess: This could be a mobile device or app, a security token, or digital ID card.</li>
<li>What you are: This is biometric data such as a fingerprint, retinal scan, or facial recognition.<h2 id="2-What-Is-Authorization"><a href="#2-What-Is-Authorization" class="headerlink" title="2. What Is Authorization"></a>2. What Is Authorization</h2>Authorization in system security is the process of giving the user permission to access a specific resource or function. This term is often used interchangeably with access control or client privilege.<br>common implementation methods:</li>
<li>Role-based access controls (RBAC)</li>
<li>Attribute-based access control (ABAC)</li>
</ul>
<h2 id="3-password-based-Authentication"><a href="#3-password-based-Authentication" class="headerlink" title="3. password based Authentication"></a>3. password based Authentication</h2><ol>
<li>don’t save password as plain text<br>some alterbatives</li>
</ol>
<ul>
<li>One-way HASH algorithm<br>like MD5, SHA1, SHA256<ul>
<li>feature:<ul>
<li>One-way hashing from the same password, the obtained is always a uniquely determined digest</li>
<li>Fast computation speed. With technological advances, especially the popularity of graphics cards in high-performance computing, billions of one-way hash calculations can be done in a second</li>
</ul>
</li>
<li>problem:<ul>
<li>Considering that most people use common combinations of passwords, an attacker can hash all the common combinations of passwords in one way to get a digest combination, and then compare it with the digest in the  database to get the corresponding password. It is also known as rainbow table.</li>
</ul>
</li>
</ul>
</li>
<li>simple salted hash<br>add random data to the input of a hash function to guarantee a unique output, the hash, even when the inputs are the same.<ul>
<li>features:<br>The biggest advantage of this approach over the above solution is that for each password in the database, a complete rainbow table needs to be created for matching. This is because two accounts that also use the same password have completely different summaries stored in the database.</li>
</ul>
</li>
</ul>
<h3 id="4-cookie-session-Authorization"><a href="#4-cookie-session-Authorization" class="headerlink" title="4. cookie + session Authorization"></a>4. cookie + session Authorization</h3><p>Firstly, why we need the cookie and session?<br>because http are stateless<br>Also, cookie is only one way to implemented<br>The workflow of this will be</p>
<ul>
<li>First, the client sends an http request to the server side.</li>
<li>The server side accepts the client request, creates a session, and sends an http response to the client, which contains the Set-Cookie header.</li>
<li>In the second request initiated by the client, if the server gives a set-Cookie, the browser will automatically add a cookie to the request header</li>
<li>The server receives the request, decomposes the cookie, verifies the information, and returns the response to the client after a successful</li>
</ul>
<p>The problem of this solution is that:<br>In practice, in production, in order to guarantee high availability, the server usually needs at least two machines, which uses load-balanced method to decide exactly which machine the request should be passed to. Suppose the login request goes to machine A, which generates the session and adds the sessionId to the cookie and returns it to the browser. The next time the user requests, if the request goes to machine B or C, B or C will not be able to find the session because it was generated on machine A.</p>
<p>some solution this problem:</p>
<ol>
<li>copy session id to every server</li>
<li>session sticky</li>
<li>Memcached - store session in my place</li>
</ol>
<p>The secuirty of cookie<br><a href="https://zhuanlan.zhihu.com/p/58666986">https://zhuanlan.zhihu.com/p/58666986</a></p>
<h3 id="5-token-based-Authorization"><a href="#5-token-based-Authorization" class="headerlink" title="5. token based Authorization"></a>5. token based Authorization</h3><p>An identifier used to denote an access grant with specific scope, duration, cryptographic properties, and other attributes.</p>
<p>There is not need to store something like session<br>One implementation is JWT<br><a href="https://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html">https://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html</a></p>
<p>Where to store the cookie:</p>
<ul>
<li>cookie<ul>
<li>You can set <code>httponly</code> to prevent it from being read by JavaScript, or secure to ensure that the token is only transmitted under HTTPS.</li>
<li>Does not conform to Restful best practices. Restful Best Practices</li>
<li>Vulnerable to CSRF attacks (can check Refer and Origin on the server side)</li>
</ul>
</li>
<li>localStorage/sessionStorage<ul>
<li>Store it in localStorage and pass it to the backend as a field or as a part of Authorization each time the interface is called<br>ref:<br><a href="https://juejin.cn/post/6922782392390746125">https://juejin.cn/post/6922782392390746125</a></li>
</ul>
</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2022-03-12T16:16:00.000Z" title="2022-03-12T16:16:00.000Z">2022-03-12</time><span class="level-item"> lawiet019 </span><span class="level-item"><a class="link-muted" href="/categories/technology/">technology</a></span><span class="level-item">4 minutes read (About 536 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/03/12/problems-faced-when-using-unittest-mock/">problems faced when using unittest.mock</a></h1><div class="content"><h2 id="the-path-in-mock-patch"><a href="#the-path-in-mock-patch" class="headerlink" title="the path in @mock.patch"></a>the path in <code>@mock.patch</code></h2><p>For <code>@mock.patch</code>, the path in mock should be the same as the actually called function.<br>Here is an example:<br>The structure of files will be<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- demo.py</span><br><span class="line">- test_demo.py</span><br></pre></td></tr></table></figure><br><code>demo.py</code><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">a</span><span class="params">()</span>:</span></span><br><span class="line">  ...</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">b</span><span class="params">()</span>:</span></span><br><span class="line">  a()</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure><br><code>test_demo.py</code><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestDemo</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line"><span class="meta">    @mock.patch("demo.a", MagicMock(return_value="..."))</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_b</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># some codes about testing b</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></table></figure><br>In that case, the mock will not take effect since the path in mock.patch <code>demo.a</code> is different from the path in actual called function <code>a()</code>, even though they are the same function indeed.<br>In order to make it work, we may need to change the structure of code.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-demo.py</span><br><span class="line">-demo0.py</span><br><span class="line">-test_demo.py</span><br></pre></td></tr></table></figure><br><code>demo0.py</code><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">a</span><span class="params">()</span>:</span></span><br><span class="line">  ...</span><br></pre></td></tr></table></figure><br><code>demo.py</code><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> demo0</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">a</span><span class="params">()</span>:</span></span><br><span class="line">  ...</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">b</span><span class="params">()</span>:</span></span><br><span class="line">  demo0.a()</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure><br><code>test_demo.py</code><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestDemo</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line"><span class="meta">    @mock.patch("demo0.a", MagicMock(return_value="..."))</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_b</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># some codes about testing b</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></table></figure><br>In that case, the mock works.</p>
<h2 id="use-mock-patch-in-LiveServerTestCase"><a href="#use-mock-patch-in-LiveServerTestCase" class="headerlink" title="use @mock.patch in LiveServerTestCase"></a>use <code>@mock.patch</code> in <code>LiveServerTestCase</code></h2><p>what is <code>LiveServerTestCase</code> in flask<br>If you want your tests done via Selenium or other headless browser like PhantomJS you can use the LiveServerTestCase:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_testing <span class="keyword">import</span> LiveServerTestCase</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTest</span><span class="params">(LiveServerTestCase)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_app</span><span class="params">(self)</span>:</span></span><br><span class="line">        app = Flask(__name__)</span><br><span class="line">        app.config[<span class="string">'TESTING'</span>] = <span class="literal">True</span></span><br><span class="line">        <span class="comment"># Default port is 5000</span></span><br><span class="line">        app.config[<span class="string">'LIVESERVER_PORT'</span>] = <span class="number">8943</span></span><br><span class="line">        <span class="comment"># Default timeout is 5 seconds</span></span><br><span class="line">        app.config[<span class="string">'LIVESERVER_TIMEOUT'</span>] = <span class="number">10</span></span><br><span class="line">        <span class="keyword">return</span> app</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_server_is_up_and_running</span><span class="params">(self)</span>:</span></span><br><span class="line">        response = urllib2.urlopen(self.get_server_url())</span><br><span class="line">        self.assertEqual(response.code, <span class="number">200</span>)</span><br></pre></td></tr></table></figure><br>The method get_server_url will return <a href="http://localhost:8943">http://localhost:8943</a> in this case.<br>It does not work when i used <code>mock.patch</code> in <code>create_app</code>.The app object is being deployed via the run() method and can’t be modified once it has been run.<br>Here is an solution online:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTest</span><span class="params">(LiveServerTestCase)</span>:</span></span><br><span class="line"><span class="meta">    @patch("...")</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, result, *mocklist)</span>:</span></span><br></pre></td></tr></table></figure><br>Let us look at <code>__call__</code><br>Before getting into application of <code>__call__()</code> we need to understand what a callable object is.<br>A callable object is one which can be called like a function.<br>In Python, <code>__call__()</code> is used to resolve the code associated with a callable object. Any object can be converted to a callable object just by writing it in a function call format. An object of that kind invokes the <code>__call__()</code> method and executes the code associated with it. This doesn’t make the object not to work like a normal one. The object can be used as a normal is used.<br>One thing to keep in mind is the object is itself used as a function, so syntax should be right.</p>
<p>Compare <code>__init__</code> with <code>__call__</code><br>The first is used to initialise newly created object, and receives arguments used to do that:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class Foo:</span><br><span class="line">    def __init__(self, a, b, c):</span><br><span class="line">        # ...</span><br><span class="line"></span><br><span class="line">x &#x3D; Foo(1, 2, 3) # __init__</span><br></pre></td></tr></table></figure><br>The second implements function call operator.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class Foo:</span><br><span class="line">    def __call__(self, a, b, c):</span><br><span class="line">        # ...</span><br><span class="line"></span><br><span class="line">x &#x3D; Foo()</span><br><span class="line">x(1, 2, 3) # __call__</span><br></pre></td></tr></table></figure></p>
<h2 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h2><p><a href="https://github.com/jarus/flask-testing/issues/107">https://github.com/jarus/flask-testing/issues/107</a><br><a href="https://www.geeksforgeeks.org/what-is-the-difference-between-__init__-and-__call__/">https://www.geeksforgeeks.org/what-is-the-difference-between-__init__-and-__call__/</a><br><a href="https://stackoverflow.com/questions/9663562/what-is-the-difference-between-init-and-call">https://stackoverflow.com/questions/9663562/what-is-the-difference-between-init-and-call</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2022-02-28T21:56:00.000Z" title="2022-02-28T21:56:00.000Z">2022-02-28</time><span class="level-item"> lawiet019 </span><span class="level-item"><a class="link-muted" href="/categories/technology/">technology</a></span><span class="level-item">a minute read (About 153 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/02/28/nil-in-golang/">nil in golang</a></h1><div class="content"><ol>
<li>what is <code>nil</code> in golang<br>nil is the zero value for pointers, interfaces, |, slices, channels and function types, representing an uninitialized value.<br>nil doesn’t mean some “undefined” state, it’s a proper value in itself. An object in Go is nil simply if and only if it’s value is nil, which it can only be if it’s of one of the aforementioned types.</li>
</ol>
<ol>
<li><p>zero value for different data types in golang<br>if the zero value is not <code>nil</code>, it cannot compare with</p>
<p>|data type| zero value|<br>|-|-|<br>|bool|false|<br>|string|””|<br>|integer|0|<br>|float|0.0|<br>|pointer|nil|<br>|interface|nil|<br>|map|nil|<br>|slice|nil|<br>|channel|nil|<br>|function|nil|<br>|struct|A zero value struct is simply a struct variable where each key’s value is set to their respective zero value.|</p>
</li>
</ol>
<ol>
<li>how to represent <code>null</code> value</li>
</ol>
<p><a href="https://github.com/guregu/null">https://github.com/guregu/null</a><br>null is a library with reasonable options for dealing with nullable SQL and JSON values</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2022-02-28T21:54:00.000Z" title="2022-02-28T21:54:00.000Z">2022-02-28</time><span class="level-item"> lawiet019 </span><span class="level-item"><a class="link-muted" href="/categories/technology/">technology</a></span><span class="level-item">8 minutes read (About 1141 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/02/28/Perforce-note-2/">Perforce note (2)</a></h1><div class="content"><h2 id="commands"><a href="#commands" class="headerlink" title="commands"></a>commands</h2><ol>
<li>basic reports commands  </li>
</ol>
<div class="table-container">
<table>
<thead>
<tr>
<th>Command</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>p4 help commands</td>
<td>Lists all Perforce commands with a brief description of each.</td>
</tr>
<tr>
<td>p4 help command</td>
<td>For any command provided, gives detailed help about that command. For example, p4 help sync provides detailed information about the p4 sync command.</td>
</tr>
<tr>
<td>p4 help usage</td>
<td>Describes command-line flags common to all Perforce commands.</td>
</tr>
<tr>
<td>p4 help views</td>
<td>Gives a discussion of Perforce view syntax.</td>
</tr>
<tr>
<td>p4 help</td>
<td>Describes all the arguments that can be given to p4 help.</td>
</tr>
<tr>
<td>p4 info</td>
<td>Reports information about the current Perforce system: the server address, client root directory, client name, user name, Perforce version, and licensing information.</td>
</tr>
</tbody>
</table>
</div>
<ol>
<li>general report commands</li>
</ol>
<div class="table-container">
<table>
<thead>
<tr>
<th>Command</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>p4 filelog</td>
<td>Generates a report on each revision of the file(s), in reverse chronological order.</td>
</tr>
<tr>
<td>p4 files</td>
<td>Lists file name, latest revision number, file type, and other information about the named file(s).</td>
</tr>
<tr>
<td>p4 sync -n</td>
<td>Tells you what p4 sync would do, without doing it.</td>
</tr>
<tr>
<td>p4 have</td>
<td>Lists all the revisions of the named files within the client that were last gotten from the depot. Without any files specifier, it lists all the files in the depot that the client has.</td>
</tr>
<tr>
<td>p4 opened</td>
<td>Reports on all files in the depot that are currently open for edit, add, delete, branch, or integrate within the client workspace.</td>
</tr>
<tr>
<td>p4 print</td>
<td>Lists the contents of the named file(s) to standard output.</td>
</tr>
<tr>
<td>p4 where</td>
<td>Given a file argument, displays the mapping of that file within the depot, the client workspace, and the local OS.</td>
</tr>
</tbody>
</table>
</div>
<ol>
<li>Resolve Reporting</li>
</ol>
<div class="table-container">
<table>
<thead>
<tr>
<th>Command</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>p4 diff [filenames]</td>
<td>Runs a diff program between the file revision currently in the client and the revision that was last gotten from the depot. If the file is not open for edit in the client, the two file revisions should be identical, so p4 diff fails. Comparison of the revisions can be forced with p4 diff -f, even when the file in the client is not open for edit</td>
<td>Although p4 diff runs a diff routine internal to Perforce, this routine can be overridden by specifying an external diff in the P4DIFF environment variable.</td>
</tr>
<tr>
<td>p4 diff2 file1 file2</td>
<td>Runs p4d’s diff subroutine on any two Perforce depot files. The specified files can be any two file revisions, even revisions of entirely different files.The diff routine used by p4d cannot be overridden.</td>
</tr>
<tr>
<td>p4 sync -n [filenames]</td>
<td>Reports what the result of running p4 sync would be, without actually performing the sync. This is useful to see which files have conflicts and need to be resolved.</td>
</tr>
<tr>
<td>p4 resolved</td>
<td>Reports which files have been resolved but not yet submitted.</td>
</tr>
<tr>
<td>p4 resolve</td>
<td>Resolve conflicts between file revision, or resolve a stream spec conflict.</td>
</tr>
</tbody>
</table>
</div>
<ol>
<li>The commands will influence changelist</li>
</ol>
<div class="table-container">
<table>
<thead>
<tr>
<th>Command</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>p4 add</td>
<td>Open file(s) in a client workspace for addition to the depot.</td>
</tr>
<tr>
<td>p4 delete</td>
<td>Open file(s) in a client workspace for deletion from the depot.</td>
</tr>
<tr>
<td>p4 edit</td>
<td>Opens files in a client workspace for edit, or open the current stream spec</td>
</tr>
<tr>
<td>p4 integrate</td>
<td>Open files and/or the stream spec for branching or merging.</td>
</tr>
<tr>
<td>p4 reopen</td>
<td>Move opened files between changelists or change the files’ type, or move the client’s stream spec to a different changelist.</td>
</tr>
<tr>
<td>p4 revert</td>
<td>Discard changes made to open files or revert an open stream spec.</td>
</tr>
</tbody>
</table>
</div>
<ol>
<li>Changelist Reporting</li>
</ol>
<div class="table-container">
<table>
<thead>
<tr>
<th>Command</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>p4 changes</td>
<td>Displays a list of all pending and submitted changelists, one line per changelist, and an abbreviated description.</td>
</tr>
<tr>
<td>p4 changes -m count</td>
<td>Limits the number of changelists reported on to the last count changelists.</td>
</tr>
<tr>
<td>p4 changes -s status</td>
<td>Limits the list to those changelists with a particular status; for example, p4 changes -s submitted will list only already submitted changelists.</td>
</tr>
<tr>
<td>p4 changes -u user</td>
<td>Limits the list to those changelists submitted by a particular user.</td>
</tr>
<tr>
<td>p4 changes -c workspace</td>
<td>Limits the list to those changelists submitted from a particular client workspace.</td>
</tr>
<tr>
<td>p4 describe changenum</td>
<td>Displays full information about a single changelist. If the changelist has already been submitted, the report includes a list of affected files and the diffs of these files. (You can use the -s flag to exclude the file diffs.)</td>
</tr>
</tbody>
</table>
</div>
<ol>
<li>Label Reporting</li>
</ol>
<div class="table-container">
<table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>p4 labels</td>
<td>List the names, dates, and descriptions of all labels known to the server</td>
</tr>
<tr>
<td>p4 labels file#revrange</td>
<td>List the names, dates, and descriptions of all labels that tag the specified revision(s) of file.</td>
</tr>
<tr>
<td>p4 files @labelname</td>
<td>Lists all files and revisions tagged by labelname.</td>
</tr>
<tr>
<td>p4 sync -n @labelname</td>
<td>Lists the revisions tagged by the label that would be brought into your client workspace, (as well as files under Perforce control that would be deleted from your client workspace because they are not tagged by the label), without updating your client workspace.</td>
</tr>
</tbody>
</table>
</div>
<ol>
<li>integrate related action</li>
</ol>
<div class="table-container">
<table>
<thead>
<tr>
<th>Command</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>p4 branch</td>
<td>If the target file does not exist, it is opened for branch. The branch action is a variant of add, but Perforce keeps a record of which source file the target file was branched from. This allows three-way merges to be performed between subsequent source and target revisions with the original source file revision as base.</td>
</tr>
<tr>
<td>p4 integrate</td>
<td>If both the source and target files exist, the target is opened for integration, which is a variant of edit. Before a user can submit a file that has been opened for integration, the source and target must be merged with p4 resolve.</td>
</tr>
<tr>
<td>p4 delete</td>
<td>When the target file exists but no corresponding source file is mapped through the branch view, the target is marked for deletion. This is consistent with integrate’s semantics: it attempts to make the target tree reflect the source tree.</td>
</tr>
</tbody>
</table>
</div>
<ol>
<li>Integration Reporting</li>
</ol>
<div class="table-container">
<table>
<thead>
<tr>
<th>Command</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr>
<td>p4 integrate -n [filepatterns]</td>
<td>Previews the results of the specified integration, but does not perform the integration. (To perform the integration, omit the -n flag.)</td>
</tr>
<tr>
<td>p4 resolve -n [filepatterns]</td>
<td>Displays files that are scheduled for resolve by p4 integrate, but does not perform the resolve. (To perform the resolve, omit the -n flag.)</td>
</tr>
<tr>
<td>p4 resolved</td>
<td>Displays files that have been resolved but not yet submitted.</td>
</tr>
<tr>
<td>p4 branches</td>
<td>Displays all branches.</td>
</tr>
<tr>
<td>p4 integrated filepatterns</td>
<td>Displays the integration history of the specified files.</td>
</tr>
<tr>
<td>p4 filelog -i [filepatterns]</td>
<td>Displays the revision histories of the specified files, including the integration histories of files from which the specified files were branched.</td>
</tr>
</tbody>
</table>
</div>
<ol>
<li>report related commands</li>
</ol>
<div class="table-container">
<table>
<thead>
<tr>
<th>Command</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr>
<td>p4 fix</td>
<td>Link jobs to the changelists that fix them.</td>
</tr>
<tr>
<td>p4 jobs -e jobview</td>
<td>…all jobs that match particular criteria</td>
</tr>
<tr>
<td>p4 jobs filespec</td>
<td>…all the jobs that were fixed by changelists that affected particular file(s)</td>
</tr>
<tr>
<td>p4 fixes -j jobname</td>
<td>…all changelists and file revisions that fixed a particular job</td>
</tr>
<tr>
<td>p4 fixes -c changenum</td>
<td>…all jobs linked to a particular changelist</td>
</tr>
<tr>
<td>p4 fixes filespec</td>
<td>…all jobs fixed by changelists that contain particular files or file revisions</td>
</tr>
</tbody>
</table>
</div>
<h2 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h2><p><a href="https://www.perforce.com/perforce/doc.051/manuals/p4guide/index.html">https://www.perforce.com/perforce/doc.051/manuals/p4guide/index.html</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2022-02-26T14:42:00.000Z" title="2022-02-26T14:42:00.000Z">2022-02-26</time><span class="level-item"> lawiet019 </span><span class="level-item"><a class="link-muted" href="/categories/technology/">technology</a></span><span class="level-item">14 minutes read (About 2095 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/02/26/Perforce-notes-1/">Perforce notes (1)</a></h1><div class="content"><h2 id="Centralized-vs-Distributed-Version-Control"><a href="#Centralized-vs-Distributed-Version-Control" class="headerlink" title="Centralized vs Distributed Version Control"></a>Centralized vs Distributed Version Control</h2><p><a href="https://www.atlassian.com/blog/software-teams/version-control-centralized-dvcs">https://www.atlassian.com/blog/software-teams/version-control-centralized-dvcs</a></p>
<h2 id="1-overview"><a href="#1-overview" class="headerlink" title="1. overview"></a>1. overview</h2><ol>
<li>Perforce is a software configuration management (SCM) tool that enables developers to version files, track changes to software development, manage releases, track defects, manage builds, and so on. Specifically.</li>
<li>Perforce is based on a client/server architecture, in which users at client workstations are connected to a central server. Each user works on a client workstation; Perforce client programs on user workstations transfer files between the workstations and the Perforce server. Perforce client programs communicate with the server using TCP/IP.<br>Workstations running Perforce client programs can be distributed around a local area network, wide area network, dialup network, or any combination thereof. Perforce client programs can also reside on the same host as the server.</li>
</ol>
<h2 id="2-important-concepts"><a href="#2-important-concepts" class="headerlink" title="2. important  concepts"></a>2. important  concepts</h2><h3 id="client-workspace"><a href="#client-workspace" class="headerlink" title="client workspace"></a><code>client workspace</code></h3><p>you create, edit, and work on files a set of directories on your local machine. These directories make up your client workspace.<br>A Perforce client workspace is a collection of files on a user’s workstation that are managed by a Perforce client program. You can have more than one Perforce client workspace per workstation. The Perforce server tracks the state of all client workspaces owned by all users, including what files are on which users’ workspaces and which users are working on which files.<br>Every client workspace on every user’s workstation has a unique name that identifies the workspace to the Perforce server. If you do not specify a name for your client workspace, the name defaults to your workstation’s name. You can override the default value by setting the P4CLIENT environment variable.<br>All files within a client workspace share a common root directory called the client workspace root. The client workspace root is the highest-level directory on your workspace under which the managed source files reside. Files under your client workspace root that are not managed by Perforce are ignored by Perforce client programs, enabling you to use Perforce to manage the source files in your client workspace while ignoring non-versioned files such as compiled object files and other temporary files created by your development tools.</p>
<h3 id="depot"><a href="#depot" class="headerlink" title="depot"></a><code>depot</code></h3><p>You use Perforce commands to move files to and from the shared file repository, called the depot.</p>
<h3 id="views"><a href="#views" class="headerlink" title="views"></a><code>views</code></h3><p>The Perforce server manages the depot - the central repository containing every revision of every file under Perforce control. Depot files are stored in folder hierarchies, rather like those on a large hard drive.<br>To control where depot files appear under your client workspace root, you must map the files and directories on the Perforce server to the corresponding areas of your client workspace. These mappings constitute your client workspace view.<br>The contents of the View: field determine where files in the depot appear on your workstation when you use p4 sync to synchronize your workspace, and where files in your client workspace are stored in the depot when you use p4 submit to update the depot with your changes.</p>
<ul>
<li>Using wildcards in views</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>Wildcard</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>*</td>
<td>Matches anything except slashes; matches files in a single directory.</td>
</tr>
<tr>
<td>…</td>
<td>Matches anything including slashes; matches in the current directory all subdirectories.</td>
</tr>
<tr>
<td>%%d</td>
<td>Used for parametric substitution in views.</td>
</tr>
</tbody>
</table>
</div>
<p>other details can be seen:<br><a href="https://www.perforce.com/perforce/doc.051/manuals/p4guide/04_details.html">https://www.perforce.com/perforce/doc.051/manuals/p4guide/04_details.html</a></p>
<h3 id="Helix-Core-Proxy-Server-P4P"><a href="#Helix-Core-Proxy-Server-P4P" class="headerlink" title="Helix Core Proxy Server (P4P)"></a><code>Helix Core Proxy Server (P4P)</code></h3><p>Helix Proxy Server (P4P) provides fast, local access to versioned files at remote sites. P4P offloads file transfer work from Helix Core</p>
<h3 id="changelist"><a href="#changelist" class="headerlink" title="changelist"></a><code>changelist</code></h3><p>A Perforce changelist is a list of files, their revision numbers, and operations to be performed on these files. You add files to a changelist with commands such as p4 add filenames or p4 edit filenames, and the changed files are stored in the depot when you submit the changelist with p4 submit.<br>When you submit a changelist to the depot, the depot is updated atomically: either all of the files in the changelist are updated in the depot, or none of them are. This grouping of files as a single unit guarantees that all files grouped together in a changelist are updated simultaneously. A Perforce changelist is an atomic change transaction.</p>
<h3 id="labels"><a href="#labels" class="headerlink" title="labels"></a><code>labels</code></h3><p>Labels provide a method of naming important sets of file revisions for future reference. You can use labels to reproduce the state of a client workspace, to branch files, and to compare files</p>
<h3 id="Branching"><a href="#Branching" class="headerlink" title="Branching"></a><code>Branching</code></h3><p>Branching is a means of keeping two or more sets of similar (but not identical) files synchronized. Most software configuration management systems have some form of branching; Perforce’s mechanism is particularly efficient because it mimics the style in which users create their own file copies when no branching mechanism is available.<br>Suppose for a moment that you’re writing a program and are not using an SCM system. You’re ready to release your program: what would you do with your code? Chances are that you’d copy all your files to a new location. One of your file sets would become your release codeline, and bug fixes to the release would be made to that file set; your other files would be your development file set, and new functionality to the code would be added to these files.</p>
<p>What would you do when you find a bug that’s shared by both file sets? You’d fix it in one file set, and then copy the edits that you made into the other file set.</p>
<p>The only difference between this homegrown method of branching and Perforce’s branching methodology is that Perforce manages the file copying and edit propagation for you. In Perforce’s terminology, copying the files is called making a branch. Each file set is known as a codeline, and copying an edit from one file set to the other is called integration. The entire process is called branching.</p>
<h3 id="job"><a href="#job" class="headerlink" title="job"></a><code>job</code></h3><p>A job is a written description of some modification to be made to a source code set. A job might be a bug description, like “the system crashes on invalid input”, or it might be a system improvement request, like “please make the program run faster.”</p>
<h2 id="3-workflow"><a href="#3-workflow" class="headerlink" title="3. workflow"></a>3. workflow</h2><h3 id="config-workspaces"><a href="#config-workspaces" class="headerlink" title="config workspaces"></a>config workspaces</h3><p>P4CONFIG specifies a file (for example, .p4env) that is used to store variable settings. Whenever a Perforce command is executed, the current working directory and its parent directories are searched for a file with the name stored in P4CONFIG. If a file with that name is found, the values of P4PORT, P4CLIENT, P4TICKETS, and so on, are read from that file. If no file of the given name is found, the current values of the Perforce environment variables are used.<br>Values that can be stored in the P4CONFIG file are:<br><code>P4CLIENT</code>,<code>P4DIFF</code>,<code>P4EDITOR</code>,<code>P4USER</code>,<code>P4CHARSET</code>,<code>P4HOST</code>,<code>P4PORT</code>,<code>P4MERGE</code>,<code>P4PASSWD</code>,<code>P4TICKETS</code>,<code>P4LANGUAGE</code>.</p>
<p>``</p>
<h3 id="submit-files"><a href="#submit-files" class="headerlink" title="submit files"></a>submit files</h3><p>When you use Perforce, you create, edit, and delete files on your own workstation in directories you specify to Perforce as client workspaces. You use Perforce commands to move files between the shared file repository (the depot) and your local workstation.<br>When you retrieve files from the depot into your client workspace, you can read, edit, and resubmit the files to the depot to make your changes accessible to other users. When a new revision of a file is stored in the depot, the old revisions of the file are preserved and are still accessible.<br>Files that you edit in your client workspace are aggregated and sent to the depot using changelists, which are lists of files and instructions that tell the depot what changes you made to those files. For example, one file might have been edited in your client workspace, another added, and another deleted. These file changes are sent to the depot in a single changelist, which is processed atomically: either all the changes are made to the files in the depot, or none are. This approach enables you to simultaneously update all files related to a bug fix or a new feature.<br>Each client workspace has its own client workspace view, which determines what files in the depot are mapped into its owner’s client workspace. One client workspace might be able to access all the files in the depot, while another client workspace might access only a single development branch. The Perforce Server tracks the state of all client workspaces, including the files in each client workspace, where they reside in the depot, and which files are being worked on by which users.<br>The commands <code>p4 add</code>, <code>p4 edit</code>, and <code>p4 delete</code> do not immediately add, edit, or delete files in the depot. Instead, the affected file and the corresponding operation are listed in the default changelist, and changes to the files in the depot occur only after the changelist is submitted to the depot with p4 submit.</p>
<h3 id="File-conflicts"><a href="#File-conflicts" class="headerlink" title="File conflicts"></a>File conflicts</h3><p>When a file conflict is detected, Perforce asks the user experiencing the conflict to perform a resolve of the conflicting files. The resolve process enables you to decide what needs to be done: should your file overwrite the other user’s? Should your own changes be discarded? Or should the two conflicting files be merged into one? At your request, Perforce performs a three-way merge between the two conflicting files and the single file that on which both files were based. This process generates a merge file from the conflicting files that contains all the changes from both conflicting versions. You can also edit the merged file before submitting the it to the depot.</p>
<h3 id="Labeling-groups-of-files"><a href="#Labeling-groups-of-files" class="headerlink" title="Labeling groups of files"></a>Labeling groups of files</h3><p>It is often useful to mark a particular set of file revisions for later access. For example, the release engineers might want to keep a list of all the file revisions that comprise a particular release of their program. This list of files can be assigned a name, such as release2.0.1; this name is a label for the user-determined list of files. At any subsequent time, the label can be used to copy its revisions into a client workspace.</p>
<h3 id="Job-tracking"><a href="#Job-tracking" class="headerlink" title="Job tracking"></a>Job tracking</h3><p>A job is a description of some change that needs to be made to a body of content or source code. A job might be a bug description, like “the system crashes when I press return”, or it might be a system improvement request, like “please make the program run faster.”<br>Perforce’s job tracking mechanism links jobs to the changelists that implement the job. (A job represents work that is intended to be performed, a changelist represents work actually done.) A job can later be examined to determine if and when it was fixed, what files were modified to implement the fix, who fixed it, and whether the fix was propagated to other codelines. The fields contained in your system’s jobs can be defined by the Perforce system administrator.</p>
<h3 id="Change-review"><a href="#Change-review" class="headerlink" title="Change review"></a>Change review</h3><p>Perforce’s change review mechanism enables users to receive email notifying them when particular files have been updated in the depot. The files for which a particular user receives notification are determined by that user. Change review in Perforce is implemented by an external program, or daemon, which can be customized.<br>Perforce can be made to run external scripts when changelists are submitted or forms are changed. These scripts, called triggers, enable you to validate changelists and forms, start build processes or perform other tasks related to workflow.</p>
<h3 id="Protections"><a href="#Protections" class="headerlink" title="Protections"></a>Protections</h3><p>Perforce provides a protection scheme to prevent unauthorized or inadvertent access to the depot. The protection mechanism determines which Perforce commands can be run by any particular user. Permissions can be granted or denied based on usernames, workstation IP addresses, and administrator-defined user groups</p>
<h3 id="Setting-up-a-client-workspace"><a href="#Setting-up-a-client-workspace" class="headerlink" title="Setting up a client workspace"></a>Setting up a client workspace</h3><p>To move files between the depot and a client workspace, the Perforce server requires two pieces of information:</p>
<ul>
<li>A name that uniquely identifies the client workspace, and</li>
<li>The top-level directory of this workspace<br>some field in setting of client workspace</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>Field</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>Root</td>
<td>Your client workspace root is the topmost subdirectory of your client workspace. Set your client workspace root to a directory under your control; you will be doing most of your development work on files located in your client workspace.</td>
</tr>
<tr>
<td>View</td>
<td>The client workspace view determines which files and directories in the depot are mapped to your client workspace, and where the files appear beneath your client workspace root.</td>
</tr>
</tbody>
</table>
</div>
<p>an example could be<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Client: eds_elm</span><br><span class="line">Owner:  edk</span><br><span class="line">Description:</span><br><span class="line">        Created by edk.</span><br><span class="line">Root:   &#x2F;usr&#x2F;edk</span><br><span class="line">Options:        nomodtime noclobber</span><br><span class="line">View:</span><br><span class="line">        &#x2F;&#x2F;depot&#x2F;...    &#x2F;&#x2F;eds_elm&#x2F;...</span><br></pre></td></tr></table></figure></p>
<h2 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h2><p><a href="https://www.perforce.com/perforce/doc.051/manuals/p4guide/index.html">https://www.perforce.com/perforce/doc.051/manuals/p4guide/index.html</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2021-12-12T22:15:00.000Z" title="2021-12-12T22:15:00.000Z">2021-12-12</time><span class="level-item"> lawiet019 </span><span class="level-item"><a class="link-muted" href="/categories/technology/">technology</a></span><span class="level-item">4 minutes read (About 569 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/12/12/blueprint-in-flask/">blueprint in flask</a></h1><div class="content"><h2 id="what-is-blueprint"><a href="#what-is-blueprint" class="headerlink" title="what is blueprint"></a>what is blueprint</h2><p>A Blueprint object works similarly to a Flask application object, but it is not actually an application. Rather it is a blueprint of how to construct or extend an application.</p>
<h2 id="why-use-blueprint"><a href="#why-use-blueprint" class="headerlink" title="why use blueprint"></a>why use blueprint</h2><p>blueprint is a very useful way to modularize your application.<br>When multiple people collaborate, each person is responsible for writing different parts, but they write codes in the same file (<code>view.py</code>), causing the problem of ignoring other people’s commits when updating the file and possibly overwriting other people’s code, this is where we decided to use blueprints to solve this problem, each person only needs to focus on the code file they are responsible for.<br>The structure of from<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Appserver&#x2F; </span><br><span class="line">├── App  </span><br><span class="line">│   ├── static&#x2F;        </span><br><span class="line">│   ├── templates&#x2F;    </span><br><span class="line">│   ├── __init__.py    </span><br><span class="line">│   └── view.py    #  write routes here </span><br><span class="line">├── run.py   </span><br><span class="line">├── config.py    </span><br><span class="line">├── requirements     </span><br><span class="line">└── README.md </span><br><span class="line">&#96;&#96;&#96; </span><br><span class="line"></span><br><span class="line">to</span><br></pre></td></tr></table></figure><br>Appserver/<br>├── app<br>│   ├── static/<br>│   ├── templates/<br>│   ├── json_test/<br>│   ├── <strong>init</strong>.py<br>│   ├── store_info.py # blueprint<br>│   ├── user_info.py # blueprint<br>│   ├── order_info.py # blueprint<br>│   ├── store_by_id.py # blueprint<br>│   ├── orders_by_user_id.py # blueprint<br>│   ├── type_search.py # blueprint<br>│   ├── user_login.py # blueprint<br>│   ├── models.py<br>│   ├── createdb.py<br>│   └── view.py # register blueprint<br>├── config.py<br>├── run.py<br>├── requirements<br>└── README.md</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## How to use it </span><br><span class="line">1. Making a Flask Blueprint</span><br><span class="line">&#96;&#96;&#96;python</span><br><span class="line">from flask import Blueprint</span><br><span class="line">example_blueprint &#x3D; Blueprint(&#39;example_blueprint&#39;, __name__)</span><br></pre></td></tr></table></figure>
<p>Note that in the above code, some arguments are specified when creating the Blueprint object. The first argument, <code>&quot;example_blueprint&quot;</code>, is the Blueprint’s name, which is used by Flask’s routing mechanism. The second argument, <code>__name__</code>, is the Blueprint’s import name, which Flask uses to locate the Blueprint’s resources.<br>There are other optional arguments that you can provide to alter the Blueprint’s behavior:</p>
<p>|paramters | meaning|<br>|static_folder| the folder where the Blueprint’s static files can be found|<br>|static_url_path| the URL to serve static files from|<br>|template_folder| the folder containing the Blueprint’s templates|<br>|url_prefix| the path to prepend to all of the Blueprint’s URLs|<br>|subdomain| the subdomain that this Blueprint’s routes will match on by default|<br>|url_defaults| a dictionary of default values that this Blueprint’s views will receive|<br>|root_path| the Blueprint’s root directory path, whose default value is obtained from the Blueprint’s import name|</p>
<ol>
<li>use the decorator<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@example_blueprint.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"This is an example app"</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>You decorate index() using example_blueprint.route and associate the function to the URL /.</p>
<p>Blueprint objects also provide other methods that you may find useful:</p>
<p><code>.errorhandler()</code> to register an error handler function<br><code>.before_request()</code> to execute an action before every request<br><code>.after_request()</code> to execute an action after every request<br><code>.app_template_filter()</code> to register a template filter at the application level</p>
<h2 id="referemce"><a href="#referemce" class="headerlink" title="referemce"></a>referemce</h2><p><a href="https://blog.csdn.net/m0_38088298/article/details/8086694">https://blog.csdn.net/m0_38088298/article/details/8086694</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2021-11-27T16:08:00.000Z" title="2021-11-27T16:08:00.000Z">2021-11-27</time><span class="level-item"> lawiet019 </span><span class="level-item"><a class="link-muted" href="/categories/technology/">technology</a></span><span class="level-item">4 minutes read (About 590 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/11/27/parallel-in-go/">parallel in go</a></h1><div class="content"><h2 id="what-is-goroutine"><a href="#what-is-goroutine" class="headerlink" title="what is goroutine"></a>what is goroutine</h2><p>A goroutine is a lightweight thread managed by the Go runtime.<br><code>go f(x, y, z)</code> will start a goroutine for function f.</p>
<h2 id="how-goroutine-actually-work"><a href="#how-goroutine-actually-work" class="headerlink" title="how goroutine actually work"></a>how goroutine actually work</h2><p><a href="https://riteeksrivastava.medium.com/a-complete-journey-with-goroutines-8472630c7f5c">https://riteeksrivastava.medium.com/a-complete-journey-with-goroutines-8472630c7f5c</a></p>
<h2 id="how-goroutine-communicate-channel"><a href="#how-goroutine-communicate-channel" class="headerlink" title="how goroutine communicate - channel"></a>how goroutine communicate - channel</h2><p><code>ch = make(chan int)</code><br>Only int type can be sent to channel<br>By default, sends and receives block until the other side is ready. This allows goroutines to synchronize without explicit locks or condition variables.<br>Channels can be buffered. Provide the buffer length as the second argument to make to initialize a buffered channel:<br><code>ch := make(chan int, 100)</code></p>
<h2 id="wait-in-goroutine"><a href="#wait-in-goroutine" class="headerlink" title="wait in goroutine"></a>wait in goroutine</h2><ul>
<li><p>use channel</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">bool</span>, <span class="number">100</span>)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">100</span>; i++ &#123;</span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">            fmt.Println(i)</span><br><span class="line">            c &lt;- <span class="literal">true</span></span><br><span class="line">        &#125;(i)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">100</span>; i++ &#123;</span><br><span class="line">        &lt;-c</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This method is a little better but sacrifices some flexibility. For instance, it introduces some additional weirdness in the case that we don’t actually know how many goroutines we want to spin up ahead of time.</p>
</li>
<li><p>use <code>waitGroup()</code></p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	wg := sync.WaitGroup&#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">		wg.Add(<span class="number">1</span>)</span><br><span class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">			fmt.Println(i)</span><br><span class="line">			wg.Done()</span><br><span class="line">		&#125;(i)</span><br><span class="line">	&#125;</span><br><span class="line">	wg.Wait()</span><br><span class="line">	fmt.Println(<span class="string">"end"</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="return-value-in-goroutine"><a href="#return-value-in-goroutine" class="headerlink" title="return value in goroutine"></a>return value in goroutine</h2><p>We cannot get the return value from goroutine. In that case, we could use <code>channel</code> to get the value.<br>To get the error return from the goroutine we could use <code>errgroup</code></p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"sync"</span></span><br><span class="line">    <span class="string">"runtime"</span></span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"errors"</span></span><br><span class="line">    <span class="string">"golang.org/x/sync/errgroup"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">try</span><span class="params">()</span> <span class="params">(<span class="keyword">bool</span>, error)</span></span> &#123;</span><br><span class="line">    errg := <span class="built_in">new</span>(errgroup.Group)</span><br><span class="line"></span><br><span class="line">    s := []<span class="keyword">int</span>&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i, val := <span class="keyword">range</span> s &#123;       </span><br><span class="line">        i := i</span><br><span class="line">        val := val</span><br><span class="line"></span><br><span class="line">        errg.Go(<span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>, val <span class="keyword">int</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">                <span class="keyword">if</span> i == <span class="number">3</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> errors.New(<span class="string">"one error"</span>)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;(i, val)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">if</span> err := errg.Wait(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="comment">// handle error</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>, <span class="literal">nil</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="string">``</span><span class="string">` </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="function"><span class="keyword">func</span> <span class="params">(g *Group)</span> <span class="title">Go</span><span class="params">(f <span class="keyword">func</span>()</span> <span class="title">error</span>)`</span></span><br><span class="line">Go calls the given function in a <span class="built_in">new</span> goroutine.</span><br><span class="line"></span><br><span class="line">The first call to <span class="keyword">return</span> a non-<span class="literal">nil</span> error cancels the group; its error will be returned by Wait.</span><br><span class="line"><span class="string">`func (g *Group) Wait() error`</span></span><br><span class="line"></span><br><span class="line">Wait blocks until all function calls from the Go method have returned, then returns the first non-<span class="literal">nil</span> error (<span class="keyword">if</span> any) from them.</span><br><span class="line">## mutex and lock  in <span class="keyword">go</span> </span><br><span class="line">Go<span class="string">'s standard library provides mutual exclusion with `sync.Mutex` and its two methods:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`Lock`</span></span><br><span class="line"><span class="string">`Unlock`</span></span><br></pre></td></tr></table></figure>
<p>// SafeCounter is safe to use concurrently.<br>type SafeCounter struct {<br>    mu sync.Mutex<br>    v  map[string]int<br>}</p>
<p>// Inc increments the counter for the given key.<br>func (c *SafeCounter) Inc(key string) {<br>    c.mu.Lock()<br>    // Lock so only one goroutine at a time can access the map c.v.<br>    c.v[key]++<br>    c.mu.Unlock()<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Also golang support lock for read and lock for write </span><br><span class="line">lock for read: multiple goroutine could read while none can write </span><br><span class="line">lock for write: only one can write, none can read</span><br></pre></td></tr></table></figure><br>sync.RWMutex{} // create mutex for read-write lock </p>
<p>func (*RWMutex) Lock // lock for write </p>
<p>func (*RWMutex) Unlock // unlock for write </p>
<p>func (*RWMutex) RLock // lock for read </p>
<p>func (*RWMutex) RUnlock // unlock for read<br>```</p>
<h2 id="map-in-gorouine"><a href="#map-in-gorouine" class="headerlink" title="map in gorouine"></a>map in gorouine</h2><p>Before Golang 1.6, concurrent read is OK, concurrent write is not OK, but write and concurrent read is OK. Since Golang 1.6, map cannot be read when it’s being written.<br>We have some solutions to this:</p>
<ol>
<li>use <code>sync.Map()</code> instead of <code>map</code></li>
<li>use <code>mutex</code> when read or write.</li>
</ol>
<h2 id="atom-Values"><a href="#atom-Values" class="headerlink" title="atom.Values"></a>atom.Values</h2><p><a href="https://studygolang.com/articles/23242?fr=sidebar">https://studygolang.com/articles/23242?fr=sidebar</a><br>side note:<br>when we need to check the type when we load value from atom.</p>
<h2 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h2><p><a href="https://nathanleclaire.com/blog/2014/02/15/how-to-wait-for-all-goroutines-to-finish-executing-before-continuing/">https://nathanleclaire.com/blog/2014/02/15/how-to-wait-for-all-goroutines-to-finish-executing-before-continuing/</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2021-11-20T15:40:00.000Z" title="2021-11-20T15:40:00.000Z">2021-11-20</time><span class="level-item"> lawiet019 </span><span class="level-item"><a class="link-muted" href="/categories/technology/">technology</a></span><span class="level-item">4 minutes read (About 636 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/11/20/defer-in-go/">defer in go</a></h1><div class="content"><h2 id="what-is-defer"><a href="#what-is-defer" class="headerlink" title="what is defer"></a>what is <code>defer</code></h2><p>A <code>defer</code> statement defers the execution of a function until the surrounding function returns.<br>eg:<br><code>defer fmt.Print(&quot;Hello World&quot;)</code></p>
<h2 id="execution-of-defer"><a href="#execution-of-defer" class="headerlink" title="execution of defer"></a>execution of <code>defer</code></h2><p>The order of execution of defer is: defer latest will be executed first.<br>The execution order of defer is after return, but before the return value is returned to the caller, so using defer can serve the purpose of modifying the return value.<br>Here is an example<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test4</span><span class="params">()</span> <span class="params">(x <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		x = <span class="number">10</span></span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	x = <span class="number">7</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">9</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Print(test4()) <span class="comment">// 10</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>Here is an example with a little difference<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test4</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> x <span class="keyword">int</span></span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		x = <span class="number">10</span></span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	x = <span class="number">7</span></span><br><span class="line">	<span class="keyword">return</span> x</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Print(test4())<span class="comment">//9</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>Here is the detail of <code>return</code> and <code>defer</code></p>
<ul>
<li>Assign <code>x</code> to the return value (which can be interpreted as Go automatically creating a parameter <code>retValue</code>, equivalent to executing <code>retValue = x</code>)</li>
<li>Check if there is a defer, and if so, execute</li>
<li>return the <code>retValue</code> just created</li>
</ul>
<p>In that case, for the first example, since we define the return parameter name at vary beginning, it will not create a <code>retValue</code>.So the <code>defer</code> directly change the return value. While the second example just change the value of <code>x</code> rather than the return value.</p>
<p>And even though when <code>panic</code> happens, defer will execute. When <code>os.Exit()</code> was hit, defer will not execute.</p>
<h2 id="the-parameter-in-defer"><a href="#the-parameter-in-defer" class="headerlink" title="the parameter in defer"></a>the parameter in <code>defer</code></h2><p>An example from  <a href="https://stackoverflow.com/questions/52718143/is-golang-defer-statement-execute-before-or-after-return-statement">stackoverflow</a>.<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test4</span><span class="params">()</span> <span class="params">(x <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">(n <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">        fmt.Printf(<span class="string">"in defer x as parameter: x = %d\n"</span>, n)</span><br><span class="line">        fmt.Printf(<span class="string">"in defer x after return: x = %d\n"</span>, x)</span><br><span class="line">    &#125;(x)</span><br><span class="line"></span><br><span class="line">    x = <span class="number">7</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">9</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ol>
<li>invoke defer, evaluating the value of n, <code>n = x = 0</code>, so x as parameter is 0.</li>
<li>execute defer, pushing <code>func(n int)(0)</code> onto stack.</li>
<li>execute func(n int)(0) after return 9, n in <code>fmt.Printf(&quot;in defer x as parameter: x = %d\n&quot;, n)</code> has been evaluated, <code>x in fmt.Printf(&quot;in defer x after return: x = %d\n&quot;, x)</code> will be evaluated now, x is 9。</li>
</ol>
<p>Some notes:</p>
<ol>
<li>the parameter’s value has been set when define the defer</li>
<li>pass parameter to function is value-copy. <code>x</code> and <code>n</code> has different address</li>
<li>It is related to Function closures. Anonymous function that references variables declared outside of the function itself. Anonymous function can gain  and change the value of references variables.</li>
</ol>
<h2 id="the-order-of-defer-and-err-handler-matters"><a href="#the-order-of-defer-and-err-handler-matters" class="headerlink" title="the order of defer and err handler matters"></a>the order of defer and err handler matters</h2><p>The code below will panic because we fail to  open the file but still want to close it.<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">do</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">  res, err := http.Get(<span class="string">"http://notexists"</span>)</span><br><span class="line">  <span class="keyword">defer</span> res.Body.Close()</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> err</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ..code...</span></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//panic: runtime error: invalid memory address or nil pointer dereference</span></span><br></pre></td></tr></table></figure><br>We slightly change the below code<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">do</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">  res, err := http.Get(<span class="string">"http://notexists"</span>)</span><br><span class="line">  <span class="keyword">if</span> res != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> res.Body.Close()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> err</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ..code...</span></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="some-tricks-when-using-Close-and-defer"><a href="#some-tricks-when-using-Close-and-defer" class="headerlink" title="some tricks when using Close and defer"></a>some tricks when using Close and defer</h2><ol>
<li><p>don’t close twice<br>Here is an example close twice. As we’ve seen before, when defers run, only the last variable gets used. So, f variable will become the last one (another-book.txt). And, both defers will see it as the last one.</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">do</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">  f, err := os.Open(<span class="string">"book.txt"</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> err</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> err := f.Close(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="comment">// log etc</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;()</span><br><span class="line">  <span class="comment">// ..code...</span></span><br><span class="line">  f, err = os.Open(<span class="string">"another-book.txt"</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> err</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> err := f.Close(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="comment">// log etc</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;()</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>check the error when closing<br>we’d better write like this</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">	 <span class="keyword">if</span> err := f.Close(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		 <span class="comment">// log etc</span></span><br><span class="line">	 &#125;</span><br><span class="line"> &#125;()</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h2><p><a href="https://www.jianshu.com/p/79c029c0bd58">https://www.jianshu.com/p/79c029c0bd58</a><br><a href="https://blog.learngoprogramming.com/5-gotchas-of-defer-in-go-golang-part-iii-36a1ab3d6ef1">https://blog.learngoprogramming.com/5-gotchas-of-defer-in-go-golang-part-iii-36a1ab3d6ef1</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2021-09-15T19:03:00.000Z" title="2021-09-15T19:03:00.000Z">2021-09-15</time><span class="level-item"> lawiet019 </span><span class="level-item"><a class="link-muted" href="/categories/technology/">technology</a></span><span class="level-item">6 minutes read (About 930 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/09/15/notes-of-nginx-learning-11/">notes of nginx learning (11)</a></h1><div class="content"><ul>
<li><strong>what is Load Balance</strong></li>
</ul>
<p>Efficiently distributing incoming network traffic across a group of backend servers, also known as a server farm or server pool.</p>
<p>The mechanism can be seen as<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">     request</span><br><span class="line">user -------&gt; load balancer ------&gt; server 1</span><br><span class="line">     &lt;-------               ------&gt; server 2</span><br><span class="line">     response               ------&gt; server 3</span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong>Some directives we may use for load Balance</strong></li>
</ul>
<p><code>upstream name { ... }</code><br><code>server address [parameters];</code><br><code>keepalive connections;</code><br><code>keepalive_requests number;</code><br><code>keepalive_timeout</code><br><code>queue</code></p>
<ul>
<li><strong>how to realize the load balancer in nginx</strong></li>
</ul>
<p>Firstly, let we create a file named <code>loadbalancer.conf</code>(we will include it in <code>nginx.conf</code>)<br>The file looks like:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">upstream servers &#123;</span><br><span class="line">  server 127.0.0.1:8021 weight&#x3D;20;</span><br><span class="line">  server 127.0.0.1:8022 weight&#x3D;5;</span><br><span class="line">  server 127.0.0.1:8023 weight&#x3D;1 ;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">  listen 8080;</span><br><span class="line">  server_name localhost;</span><br><span class="line">  location &#x2F;loadbalancer &#123;</span><br><span class="line">    proxy_pass http:&#x2F;&#x2F;servers;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">  listen 8021;</span><br><span class="line">  location &#x2F; &#123;</span><br><span class="line">    return 200 &#39;the port is 8021&#39;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">  listen 8022;</span><br><span class="line">  location &#x2F; &#123;</span><br><span class="line">    return 200 &#39;the port is 8022&#39;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">  listen 8023;</span><br><span class="line">  location &#x2F; &#123;</span><br><span class="line">    return 200 &#39;the port is 8023&#39;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>After reloading the configuration file,  we could use <code>curl localhost:8080/loadbalancer</code> to test the change. We could see that <code>the port is 8021</code> appears most, followed by <code>the port is 8022</code> because of the weight we set.</p>
<ul>
<li><strong>load balance algorithm  - round robin</strong></li>
</ul>
<p>Round Robin – Requests are distributed evenly across the servers, with server weights taken into consideration. This method is used by default.<br>The example:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">upstream servers &#123;</span><br><span class="line">  server 127.0.0.1:8021 weight&#x3D;20;</span><br><span class="line">  server 127.0.0.1:8022 weight&#x3D;5;</span><br><span class="line">  server 127.0.0.1:8023 weight&#x3D;1;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p><strong>load balance algorithm  - hash algorithm</strong></p>
<ul>
<li>what is hash function</li>
</ul>
<p>A hash function is any function that can be used to map data of arbitrary size to fixed-size values. And it is irreversible</p>
<p>The most important thing about hashing is that:</p>
<ol>
<li>The same input must yield the same output;</li>
<li>Different inputs are likely to produce different outputs</li>
</ol>
<p>The purpose of a hash algorithm is to verify that the original data has not been tampered with</p>
<ul>
<li>directive used in load balance algorithm based on hashing.</li>
</ul>
<ol>
<li><code>hash</code></li>
</ol>
<p><code>hash key [consistent];</code><br>Specifies a load balancing method for a server group where the client-server mapping is based on the hashed key value.The key can contain text, variables, and their combinations. Note that adding or removing a server from the group may result in remapping most of the keys to different servers.<br>Context:    upstream</p>
<ol>
<li><code>ip_hash</code></li>
</ol>
<p><code>ip_hash;</code></p>
<p>Specifies that a group should use a load balancing method where requests are distributed between servers based on client IP addresses. The first three octets of the client IPv4 address, or the entire IPv6 address, are used as a hashing key. The method ensures that requests from the same client will always be passed to the same server except when this server is unavailable.<br>Context:    upstream</p>
<ul>
<li>to implement the load balance algorithm in nginx</li>
</ul>
<p>Firstly, let we create a file named <code>balance_hash.conf</code>(we will include it in <code>nginx.conf</code>)<br>The file looks like:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">  server 127.0.0.1:8081;</span><br><span class="line">  server 127.0.0.1:8082;</span><br><span class="line">  hash $request_uri;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">  listen 8080;</span><br><span class="line">  server_name localhost;</span><br><span class="line">  location &#x2F;hash &#123;</span><br><span class="line">    proxy_pass http:&#x2F;&#x2F;backend;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">  listen 8081;</span><br><span class="line">  location &#x2F; &#123;</span><br><span class="line">    return 200 &#39;it listens on port 8081&#39;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">  listen 8082;</span><br><span class="line">  location &#x2F; &#123;</span><br><span class="line">    return 200 &#39;it listens on port 8082&#39;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>In this file, we use <code>$request_uri</code> as the key for hashing. And we could test like <code>curl localhost:8080/hash/apple.html</code>  or <code>curl localhost:8080/hash/test.html</code> to see whether the same url will be handled by the same server.</p>
</li>
<li><p><strong>load balance algorithm - Least Connections</strong></p>
<p>A request is sent to the server with the least number of active connections, again with server weights taken into consideration:<br>example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> upstream backend &#123;</span><br><span class="line">    least_conn;</span><br><span class="line">    server backend1.example.com;</span><br><span class="line">    server backend2.example.com;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>fault-tolerant mechanism in load balancer</strong></p>
</li>
</ul>
<p>When one backend server doesn’t give expected result to nginx, it will send the request to another server.<br>Here are some directives we may use.</p>
<ol>
<li><code>proxy_next_upstream</code></li>
</ol>
<p><code>proxy_next_upstream error | timeout | invalid_header | http_500 | http_502 | http_503 | http_504 | http_403 | http_404 | http_429 | non_idempotent | off ...;</code><br>Default:    <code>proxy_next_upstream error timeout;</code><br>Context:    http, server, location</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>parameter</th>
<th>detail</th>
</tr>
</thead>
<tbody>
<tr>
<td>error</td>
<td>an error occurred while establishing a connection with the server, passing a request to it, or reading the response header;</td>
</tr>
<tr>
<td>timeout</td>
<td>a timeout has occurred while establishing a connection with the server, passing a request to it, or reading the response header;</td>
</tr>
<tr>
<td>invalid_header</td>
<td>a server returned an empty or invalid response;</td>
</tr>
<tr>
<td>http_500</td>
<td>a server returned a response with the code 500;</td>
</tr>
<tr>
<td>http_502</td>
<td>a server returned a response with the code 502;</td>
</tr>
<tr>
<td>http_503</td>
<td>a server returned a response with the code 503;</td>
</tr>
<tr>
<td>http_504</td>
<td>a server returned a response with the code 504;</td>
</tr>
<tr>
<td>http_403</td>
<td>a server returned a response with the code 403;</td>
</tr>
<tr>
<td>http_404</td>
<td>a server returned a response with the code 404;</td>
</tr>
<tr>
<td>http_429</td>
<td>a server returned a response with the code 429;</td>
</tr>
<tr>
<td>non_idempotent</td>
<td>normally, requests with a non-idempotent method (POST, LOCK, PATCH) are not passed to the next server if a request has been sent to an upstream server (1.9.13); enabling this option explicitly allows retrying such requests;</td>
</tr>
<tr>
<td>off</td>
<td>disables passing a request to the next server.</td>
</tr>
</tbody>
</table>
</div>
<p>For example<br><code>proxy_next_upstream error timeout http_500;</code></p>
<ol>
<li><code>proxy_next_upstream_timeout</code></li>
</ol>
<p><code>proxy_next_upstream_timeout time;</code><br>Limits the time during which a request can be passed to the next server. The 0 value turns off this limitation.<br>Default:    <code>proxy_next_upstream_timeout 0;</code><br>Context:    http, server, location</p>
<ol>
<li><code>proxy_next_upstream_tries</code></li>
</ol>
<p><code>proxy_next_upstream_tries number;</code><br>Limits the number of possible tries for passing a request to the next server. The 0 value turns off this limitation.<br>Default:    <code>proxy_next_upstream_tries 0;</code><br>Context:    http, server, location</p>
<ol>
<li><code>proxy_intercept_errors</code></li>
</ol>
<p><code>proxy_intercept_errors on | off;</code><br>Determines whether proxied responses with codes greater than or equal to 300 should be passed to a client or be intercepted and redirected to nginx for processing with the error_page directive.<br>If you have set proxy_next_upstream, it will not work.<br>Default:    <code>proxy_intercept_errors off;</code><br>Context:    http, server, location</p>
<ul>
<li><strong>reference</strong><br><a href="https://nginx.org/en/docs/dirindex.html">https://nginx.org/en/docs/dirindex.html</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2021-09-15T19:00:00.000Z" title="2021-09-15T19:00:00.000Z">2021-09-15</time><span class="level-item"> lawiet019 </span><span class="level-item"><a class="link-muted" href="/categories/technology/">technology</a></span><span class="level-item">17 minutes read (About 2530 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/09/15/notes-of-nginx-learning-10/">notes of nginx learning (10)</a></h1><div class="content"><ul>
<li><strong>what is Reverse proxy server</strong></li>
</ul>
<ol>
<li>what is Reverse proxy server</li>
</ol>
<p>The reverse proxy server is located between the user and the actual server and provides a relay service for requests and responses.<br>For the user, access to the reverse proxy server is access to the actual server.<br>Reverse proxy can reduce server load consumption and increase efficiency</p>
<ol>
<li>the advantages of reverse proxy server<ul>
<li>hide the actual server</li>
<li>Horizontal expansion of back-end dynamic services</li>
<li>Separation of dynamic resources and static resources to improve system robustness</li>
</ul>
</li>
</ol>
<ul>
<li><strong>Dynamic and Static Separation</strong></li>
</ul>
<p>Deploy static website resources (HTML, JavaScript, CSS, img, etc.) separately from backend applications to improve the speed of user access to static code and reduce access to backend applications<br>One approach is to deploy the static resources on nginx(sometimes we could put static resources on CDN), and the backend project to the application server.</p>
<ul>
<li><strong>Supported protocols when using Nginx as a reverse proxy</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># transportation layer</span><br><span class="line">client-----&gt; nginx -----&gt; server</span><br><span class="line">      tcp           tcp</span><br><span class="line">      udp           udp</span><br><span class="line"></span><br><span class="line">client-----&gt; nginx -----&gt; server</span><br><span class="line">      http         fastcgi</span><br><span class="line">                   scgi</span><br><span class="line">                   uwsgi</span><br><span class="line">                   http</span><br><span class="line">                   grpc</span><br><span class="line">                   memcached</span><br><span class="line">                   websocket</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Look into module ngx_http_upstream_module</strong></li>
</ul>
<p>The ngx_http_upstream_module module is used to define groups of servers that can be referenced by the <code>proxy_pass</code>, <code>fastcgi_pass</code>, <code>uwsgi_pass</code>, <code>scgi_pass</code>, <code>memcached_pass</code>, and <code>grpc_pass directives</code>.</p>
<p>By default, the nginx is compiled with <code>http_upstream_module</code> . If we don’t want that, we need to use <code>--without-http_upstream_module</code>.</p>
<p>Let us look at directives</p>
<ol>
<li><code>upstream</code></li>
</ol>
<p><code>upstream name { ... }</code><br>Defines a group of servers in a block. Servers can listen on different ports. In addition, servers listening on TCP and UNIX-domain sockets can be mixed.<br>Context:    http<br>Here is the example:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    server backend1.example.com weight&#x3D;5;</span><br><span class="line">    server 127.0.0.1:8080       max_fails&#x3D;3 fail_timeout&#x3D;30s;</span><br><span class="line">    server unix:&#x2F;tmp&#x2F;backend3;</span><br><span class="line"></span><br><span class="line">    server backup1.example.com  backup;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ol>
<li><code>server</code></li>
</ol>
<p><code>server address [parameters];</code><br>Defines the address and other parameters of a server. The address can be specified as a domain name or IP address, with an optional port, or as a UNIX-domain socket path specified after the “unix:” prefix. If a port is not specified, the port 80 is used. A domain name that resolves to several IP addresses defines multiple servers at once.<br>Context:    upstream</p>
<p>Here is the parameters</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>parameter</th>
<th>detail</th>
</tr>
</thead>
<tbody>
<tr>
<td>weight=number</td>
<td>sets the weight of the server, by default, 1. The weight is larger, the nginx will giver more requests to the server</td>
</tr>
<tr>
<td>max_conns=number</td>
<td>limits the maximum number of simultaneous active connections to the proxied server.Default value is zero, meaning there is no limit. If the server group does not reside in the shared memory, the limitation works per each worker process.</td>
</tr>
<tr>
<td>max_fails=number</td>
<td>sets the number of unsuccessful attempts to communicate with the server that should happen in the duration set by the fail_timeout parameter to consider the server unavailable for a duration also set by the fail_timeout parameter.</td>
</tr>
<tr>
<td>fail_timeout=time</td>
<td>the time during which the specified number of unsuccessful attempts to communicate with the server should happen to consider the server unavailable; and the period of time the server will be considered unavailable.</td>
</tr>
</tbody>
</table>
</div>
<p>By default, the parameter is set to 10 seconds|<br>|backup|marks the server as a backup server. It will be passed requests when the primary servers are unavailable.|<br>|down|marks the server as a backup server. It will be passed requests when the primary servers are unavailable.|<br>|resolve|monitors changes of the IP addresses that correspond to a domain name of the server, and automatically modifies the upstream configuration without the need of restarting nginx (1.5.12). The server group must reside in the shared memory. In order for this parameter to work, the resolver directive must be specified in the http block or in the corresponding upstream block.|<br>|route=string|sets the server route name.|<br>|service=name|enables resolving of DNS SRV records and sets the service name (1.9.13). In order for this parameter to work, it is necessary to specify the resolve parameter for the server and specify a hostname without a port number.|<br>|slow_start=time|sets the time during which the server will recover its weight from zero to a nominal value, when unhealthy server becomes healthy, or when the server becomes available after a period of time it was considered unavailable. Default value is zero, i.e. slow start is disabled.|<br>|drain|puts the server into the “draining” mode (1.13.6). In this mode, only requests bound to the server will be proxied to it.|</p>
<ol>
<li><code>zone</code></li>
</ol>
<p><code>zone name [size];</code><br>Defines the name and size of the shared memory zone that keeps the group’s configuration and run-time state that are shared between worker processes. Several groups may share the same zone. In this case, it is enough to specify the size only once.<br>Context:    upstream</p>
<ol>
<li><code>keepalive</code></li>
</ol>
<p><code>keepalive connections;</code><br>The connections parameter sets the maximum number of idle keepalive connections to upstream servers that are preserved in the cache of each worker process. When this number is exceeded, the least recently used connections are closed.<br>Context:    upstream<br>For example:<br><code>keepalive 32</code></p>
<ol>
<li><code>keepalive_requests</code></li>
</ol>
<p><code>keepalive_requests number</code><br>Sets the maximum number of requests that can be served through one keepalive connection. After the maximum number of requests is made, the connection is closed.<br>Default:    <code>keepalive_requests 1000;</code><br>Context:    upstream</p>
<ol>
<li><code>keepalive_timeout</code></li>
</ol>
<p><code>keepalive_timeout timeout;</code><br>Sets a timeout during which an idle keepalive connection to an upstream server will stay open.<br>Default:    <code>keepalive_timeout 60s;</code><br>Context:    upstream</p>
<p>And some other directives are related to load balance.<br><code>hash</code>,<code>ip_hash</code>,<code>least_conn</code>,<code>least_time</code>,<code>random</code>.  We will talk about it later.</p>
<ol>
<li><code>queue</code>[in commercial version only ]</li>
</ol>
<p><code>queue number [timeout=time];</code><br>If an upstream server cannot be selected immediately while processing a request, the request will be placed into the queue. The directive specifies the maximum number of requests that can be in the queue at the same time.<br>Context:    upstream<br>For example:<br><code>queue 100 timeout =30s</code></p>
<ul>
<li><strong>Look into proxy_pass directive</strong></li>
</ul>
<p><code>proxy_pass</code> is in <code>ngx_http_proxy_module</code> module<br>The ngx_http_proxy_module module allows passing requests to another server.<br>By default, it is compiled with <code>ngx_http_proxy_module</code>.If we don’t want to use the module <code>--without-ngx_http_proxy_module</code></p>
<p><code>proxy_pass URL;</code><br>Context:    location, if in location, limit_except<br>Sets the protocol and address of a proxied server and an optional URI to which a location should be mapped. As a protocol, “http” or “https” can be specified. The address can be specified as a domain name or IP address, and an optional port:</p>
<p><code>proxy_pass http://localhost:8000/uri/;</code><br>or as a UNIX-domain socket path specified after the word “unix” and enclosed in colons:</p>
<p><code>proxy_pass http://unix:/tmp/backend.socket:/uri/;</code><br>If a domain name resolves to several addresses, all of them will be used in a round-robin fashion. In addition, an address can be specified as a server group.</p>
<p>Let us look at the difference between URL ends with <code>/</code> and without <code>/</code></p>
<p>If the url ends without <code>/</code>,nginx will modify the url by deleting the location url in proxy url.<br>If the url ends without <code>/</code>,nginx will not modify the URL and directly send it to upstream server.</p>
<p>For example,<br>if users use url <code>bbs/abc/test.html</code>,<br>if the config file is<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location &#x2F;bbs&#x2F;&#123;</span><br><span class="line">  proxy_pass http:&#x2F;&#x2F;127.0.0.1:8000</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>the url arrive at upstream server will be <code>bbs/abc/test.html</code>.</p>
<p>if the config file is<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location &#x2F;bbs&#x2F;&#123;</span><br><span class="line">  proxy_pass http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>the url arrive at upstream server will be <code>abc/test.html</code>.</p>
<ul>
<li><strong>An example of reverse proxy by nginx</strong></li>
</ul>
<p>I don’t want to directly change the <code>nginx.conf</code> every time.  let us introduce a directive <code>include</code></p>
<p><code>include file | mask;</code><br>Includes another file, or files matching the specified mask, into configuration. Included files should consist of syntactically correct directives and blocks.<br>Context:    any</p>
<p>So to create a  new server block, we just need a include directive in <code>nginx.conf</code> like <code>include servers/*.conf;</code>. So every time we want to create a new server, we only need to create a file in servers.</p>
<p>create a file named <code>proxy.conf</code> in server folder</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    # the server can provide function</span><br><span class="line">    server 127.0.0.1:8000;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen 8081;</span><br><span class="line">    server_name localhost;</span><br><span class="line">    location &#x2F;helloworld &#123;</span><br><span class="line">      proxy_pass http:&#x2F;&#x2F;backend&#x2F;v1&#x2F;users&#x2F;helloworld;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Notice: we may need to add backend to allow_hosts in django(since the url is provided by django). Or we will face error <code>Invalid HTTP_HOST header: &#39;backend&#39;</code></p>
<p>Then we could visit <code>localhost:8081/helloworld</code></p>
<ul>
<li><strong>Some directives related to proxy</strong></li>
</ul>
<ol>
<li><code>proxy_request_buffering</code></li>
</ol>
<p><code>proxy_request_buffering on | off;</code><br>Enables or disables buffering of a client request body.</p>
<p>When buffering is enabled, the entire request body is read from the client before sending the request to a proxied server. It meets  the high throughput requirements and it is suitable when the concurrent processing capability of upstream services is low</p>
<p>When buffering is disabled, the request body is sent to the proxied server immediately as it is received. In this case, the request cannot be passed to the next server if nginx already started sending the request body. It will reduce the responses time and save disk space.</p>
<p>When HTTP/1.1 chunked transfer encoding is used to send the original request body, the request body will be buffered regardless of the directive value unless HTTP/1.1 is enabled for proxying.<br>Default:    <code>proxy_request_buffering on;</code><br>Context:    http, server, location</p>
<ol>
<li><code>client_max_body_size</code></li>
</ol>
<p><code>client_max_body_size size;</code><br>Sets the maximum allowed size of the client request body. If the size in a request exceeds the configured value, the 413 (Request Entity Too Large) error is returned to the client. Please be aware that browsers cannot correctly display this error. Setting size to 0 disables checking of client request body size.<br>Default:    <code>client_max_body_size 1m;</code><br>Context:    http, server, location</p>
<ol>
<li><code>client_body_buffer_size</code></li>
</ol>
<p><code>client_body_buffer_size size;</code><br>Sets buffer size for reading client request body. In case the request body is larger than the buffer, the whole body or only its part is written to a temporary file(defined by <code>client_body_temp_path</code>). By default, buffer size is equal to two memory pages. This is 8K on x86, other 32-bit platforms, and x86-64. It is usually 16K on other 64-bit platforms.</p>
<p>Default:    <code>client_body_buffer_size 8k|16k;</code><br>Context:    http, server, location</p>
<ol>
<li><code>client_body_temp_path</code></li>
</ol>
<p><code>client_body_temp_path path [level1 [level2 [level3]]]</code>;<br>Default:    <code>client_body_temp_path client_body_temp;</code><br>Context:    http, server, location<br>Defines a directory for storing temporary files holding client request bodies. Up to three-level subdirectory hierarchy can be used under the specified directory. For example, in the following configuration</p>
<p><code>client_body_temp_path /spool/nginx/client_temp 1 2;</code></p>
<p>a path to a temporary file might look like this:</p>
<p><code>/spool/nginx/client_temp/7/45/00000123457</code></p>
<p>Here, if there are values ​​for level1,2,3, it means that there are subdirectories at level 1, level 2, and level 3.<br>Directory names are named by numbers, so the specific value here is the number of digits representing the directory name</p>
<ol>
<li><code>client_body_in_single_buffer</code></li>
</ol>
<p><code>client_body_in_single_buffer on | off;</code><br>Determines whether nginx should save the entire client request body in a single buffer. The directive is recommended when using the $request_body variable, to save the number of copy operations involved.<br>Default:    <code>client_body_in_single_buffer off;</code><br>Context:    http, server, location</p>
<ol>
<li><code>client_body_in_file_only</code></li>
</ol>
<p><code>client_body_in_file_only on | clean | off;</code></p>
<p>Determines whether nginx should save the entire client request body into a file. This directive can be used during debugging, or when using the <code>$request_body_file</code> variable, or the <code>$r-&gt;request_body_file</code> method of the module ngx_http_perl_module.<br>When set to the value on, temporary files are not removed after request processing.<br>The value clean will cause the temporary files left after request processing to be removed.</p>
<p>Default:    <code>client_body_in_file_only off;</code><br>Context:    http, server, location</p>
<ol>
<li><code>client_body_timeout</code></li>
</ol>
<p><code>client_body_timeout time;</code><br>Default:    <code>client_body_timeout 60s;</code><br>Context:    http, server, location<br>Defines a timeout for reading client request body. The timeout is set only for a period between two successive read operations, not for the transmission of the whole request body. If a client does not transmit anything within this time, the request is terminated with the 408 (Request Time-out) error.</p>
<ul>
<li><strong>How does nginx change the request message sent upstream server when we use nginx for revese proxy</strong></li>
</ul>
<p>Look at some directives may work</p>
<ol>
<li><code>proxy_method</code></li>
</ol>
<p><code>proxy_method method;</code><br>Specifies the HTTP method to use in requests forwarded to the proxied server instead of the method from the client request. Parameter value can contain variables (1.11.6).<br>Context:    http, server, location</p>
<ol>
<li><code>proxy_http_version</code></li>
</ol>
<p><code>proxy_http_version 1.0 | 1.1;</code><br>Sets the HTTP protocol version for proxying. By default, version 1.0 is used. Version 1.1 is recommended for use with keepalive connections and NTLM authentication.<br>Default:    <code>proxy_http_version 1.0;</code><br>Context:    http, server, location</p>
<ol>
<li><code>proxy_set_header</code></li>
</ol>
<p><code>proxy_set_header field value;</code><br>Allows redefining or appending fields to the request header passed to the proxied server.<br>Default:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">proxy_set_header Host $proxy_host;&#96;</span><br><span class="line">proxy_set_header Connection close;</span><br></pre></td></tr></table></figure><br>Context:    http, server, location</p>
<ol>
<li><code>proxy_pass_request_headers</code></li>
</ol>
<p><code>proxy_pass_request_headers on | off;</code><br>Indicates whether the header fields of the original request are passed to the proxied server.<br>Default:    <code>proxy_pass_request_headers on;</code><br>Context:    http, server, location</p>
<ol>
<li><code>proxy_set_body</code></li>
</ol>
<p><code>proxy_set_body value;</code><br>Allows redefining the request body passed to the proxied server. The value can contain text, variables, and their combination.<br>Context:    http, server, location</p>
<ol>
<li><code>proxy_pass_request_body</code></li>
</ol>
<p><code>proxy_pass_request_body on | off;</code><br>Default:    <code>proxy_pass_request_body on;</code><br>Context:    http, server, location<br>Indicates whether the original request body is passed to the proxied server.</p>
<ul>
<li><strong>Details of establishing a connection between Nginx and upstream server in a proxy scenario</strong></li>
</ul>
<p>Let we look at some directives</p>
<ol>
<li><code>proxy_connect_timeout</code></li>
</ol>
<p><code>proxy_connect_timeout time;</code><br>Defines a timeout for establishing a connection with a proxied server. It should be noted that this timeout cannot usually exceed 75 seconds<br>Default:    <code>proxy_connect_timeout 60s;</code><br>Context:    http, server, location</p>
<ol>
<li><code>proxy_socket_keepalive</code></li>
</ol>
<p><code>proxy_socket_keepalive on | off;</code><br>Configures the “TCP keepalive” behavior for outgoing connections to a proxied server. By default, the operating system’s settings are in effect for the socket. If the directive is set to the value “on”, the SO_KEEPALIVE socket option is turned on for the socket.<br>Default:    <code>proxy_socket_keepalive off;</code><br>Context:    http, server, location</p>
<p>Note: there is a difference between HTTP KEEP-ALIVE and TCP KEEPALIVE.<br><a href="https://www.jianshu.com/p/cd71efa49d63">https://www.jianshu.com/p/cd71efa49d63</a></p>
<ol>
<li><code>proxy_send_timeout</code></li>
</ol>
<p><code>proxy_send_timeout time;</code><br>Sets a timeout for transmitting a request to the proxied server. The timeout is set only between two successive write operations, not for the transmission of the whole request. If the proxied server does not receive anything within this time, the connection is closed.<br>Default:    <code>proxy_send_timeout 60s;</code><br>Context:    http, server, location</p>
<ol>
<li><code>proxy_ignore_client_abort on | off;</code></li>
</ol>
<p><code>proxy_ignore_client_abort on | off;</code><br>Default:    <code>proxy_ignore_client_abort off;</code><br>Determines whether the connection with a proxied server should be closed when a client closes the connection without waiting for a response.<br>Context:    http, server, location</p>
<ul>
<li><strong>reference</strong><br><a href="https://nginx.org/en/docs/dirindex.html">https://nginx.org/en/docs/dirindex.html</a></li>
</ul>
</div></article></div><nav class="pagination is-centered mt-4" role="navigation" aria-label="pagination"><div class="pagination-previous is-invisible is-hidden-mobile"><a href="/categories/technology/page/0/">Previous</a></div><div class="pagination-next"><a href="/categories/technology/page/2/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link is-current" href="/categories/technology/">1</a></li><li><a class="pagination-link" href="/categories/technology/page/2/">2</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/categories/technology/page/5/">5</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="is-rounded" src="/img/avatar.jpeg" alt="koko"></figure><p class="title is-size-4 is-block line-height-inherit">koko</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Troy, NY</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">48</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">3</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">34</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/lawiet019" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/lawiet019"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/math/"><span class="level-start"><span class="level-item">math</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/technology/"><span class="level-start"><span class="level-item">technology</span></span><span class="level-end"><span class="level-item tag">41</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/technology/math/"><span class="level-start"><span class="level-item">math</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li></ul></div></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">Recent</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2022-04-10T02:39:00.000Z">2022-04-09</time></p><p class="title is-6"><a class="link-muted" href="/2022/04/09/Authentication-vs-Authorization-md/">Authentication_vs_Authorization.md</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/technology/">technology</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2022-03-12T16:16:00.000Z">2022-03-12</time></p><p class="title is-6"><a class="link-muted" href="/2022/03/12/problems-faced-when-using-unittest-mock/">problems faced when using unittest.mock</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/technology/">technology</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2022-02-28T21:56:00.000Z">2022-02-28</time></p><p class="title is-6"><a class="link-muted" href="/2022/02/28/nil-in-golang/">nil in golang</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/technology/">technology</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2022-02-28T21:54:00.000Z">2022-02-28</time></p><p class="title is-6"><a class="link-muted" href="/2022/02/28/Perforce-note-2/">Perforce note (2)</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/technology/">technology</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2022-02-26T14:42:00.000Z">2022-02-26</time></p><p class="title is-6"><a class="link-muted" href="/2022/02/26/Perforce-notes-1/">Perforce notes (1)</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/technology/">technology</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2022/04/"><span class="level-start"><span class="level-item">April 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2022/03/"><span class="level-start"><span class="level-item">March 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2022/02/"><span class="level-start"><span class="level-item">February 2022</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/12/"><span class="level-start"><span class="level-item">December 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/11/"><span class="level-start"><span class="level-item">November 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/09/"><span class="level-start"><span class="level-item">September 2021</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/08/"><span class="level-start"><span class="level-item">August 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/05/"><span class="level-start"><span class="level-item">May 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/12/"><span class="level-start"><span class="level-item">December 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/11/"><span class="level-start"><span class="level-item">November 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/10/"><span class="level-start"><span class="level-item">October 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/08/"><span class="level-start"><span class="level-item">August 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/07/"><span class="level-start"><span class="level-item">July 2020</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/06/"><span class="level-start"><span class="level-item">June 2020</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/05/"><span class="level-start"><span class="level-item">May 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/C/"><span class="tag">C++</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Graph/"><span class="tag">Graph</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/algorithm/"><span class="tag">algorithm</span><span class="tag is-grey-lightest">12</span></a></div><div class="control"><a class="tags has-addons" href="/tags/binary-search/"><span class="tag">binary search</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bit-manipulation/"><span class="tag">bit manipulation</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/blueprint/"><span class="tag">blueprint</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/collections/"><span class="tag">collections</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/computing/"><span class="tag">computing</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cookit/"><span class="tag">cookit</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/debug/"><span class="tag">debug</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dependency-injection/"><span class="tag">dependency injection</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dynamic-programming/"><span class="tag">dynamic programming</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flask/"><span class="tag">flask</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/go/"><span class="tag">go</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/golang/"><span class="tag">golang</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/graph/"><span class="tag">graph</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hexo/"><span class="tag">hexo</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/learning-note/"><span class="tag">learning note</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/linked-list/"><span class="tag">linked list</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mock/"><span class="tag">mock</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/multiprocess/"><span class="tag">multiprocess</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/multithread/"><span class="tag">multithread</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/network/"><span class="tag">network</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nginx/"><span class="tag">nginx</span><span class="tag is-grey-lightest">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/perforce/"><span class="tag">perforce</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/python/"><span class="tag">python</span><span class="tag is-grey-lightest">24</span></a></div><div class="control"><a class="tags has-addons" href="/tags/regular-expression/"><span class="tag">regular expression</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/session/"><span class="tag">session</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sort/"><span class="tag">sort</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sorting/"><span class="tag">sorting</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/token/"><span class="tag">token</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tool/"><span class="tag">tool</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tree/"><span class="tag">tree</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/unittest/"><span class="tag">unittest</span><span class="tag is-grey-lightest">1</span></a></div></div></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe to Updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="Subscribe"></div></div></form></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/favicon.png" alt="lawilet&#039;s website" height="28"></a><p class="size-small"><span>&copy; 2022 lawiet019</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'http://law-liet.com',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to Top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>