<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>lawilet&#039;s website</title><meta property="og:type" content="blog"><meta property="og:title" content="lawilet&#039;s website"><meta property="og:url" content="http://law-liet.com/"><meta property="og:site_name" content="lawilet&#039;s website"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://law-liet.com/img/og_image.png"><meta property="article:author" content="lawiet019"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://law-liet.com"},"headline":"lawilet's website","image":["http://law-liet.com/img/og_image.png"],"author":{"@type":"Person","name":"lawiet019"},"description":""}</script><link rel="icon" href="/img/favicon.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/favicon.png" alt="lawilet&#039;s website" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item is-active" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/lawiet019"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2021-09-02T01:32:00.000Z" title="2021-09-02T01:32:00.000Z">2021-09-01</time><span class="level-item"> lawiet019 </span><span class="level-item">4 minutes read (About 623 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/09/01/notes-of-nginx-learning-5/">notes of nginx learning (5)</a></h1><div class="content"><ul>
<li><p><strong>virtual host</strong><br>The virtual host<br><a href="https://www.youtube.com/watch?v=MmMEbLCt_-c">https://www.youtube.com/watch?v=MmMEbLCt_-c</a><br>The category of virtual host</p>
<ul>
<li>Virtual host based on  IP</li>
<li>Virtual host based on domain name</li>
</ul>
</li>
<li><p><strong>Virtual host based on  IP</strong><br>It could be multiple IPs and ports.We will show an example with multiple ports.</p>
</li>
</ul>
<ol>
<li>we need to modify <code>nginx.conf</code> by adding more server blocks because one server block corresponds to one virtual host.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">worker_processes  auto;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application&#x2F;octet-stream;</span><br><span class="line">    sendfile        on;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        location &#x2F; &#123;</span><br><span class="line">            #speicify the path for the virtual host</span><br><span class="line">            root   html&#x2F;port_virtual_host1;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page   500 502 503 504  &#x2F;50x.html;</span><br><span class="line">        location &#x3D; &#x2F;50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    # add a new server block</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       8080;</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        location &#x2F; &#123;</span><br><span class="line">            root   html&#x2F;port_virtual_host2;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page   500 502 503 504  &#x2F;50x.html;</span><br><span class="line">        location &#x3D; &#x2F;50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    # add a new server block</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       8081;</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        location &#x2F; &#123;</span><br><span class="line">            root   html&#x2F;port_virtual_host3;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page   500 502 503 504  &#x2F;50x.html;</span><br><span class="line">        location &#x3D; &#x2F;50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
After that, we need to reload the config file</li>
<li><p>make the <code>index.html</code> for each virtual host</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;html</span><br><span class="line">sudo mkdir port_virtual_host1</span><br><span class="line">sudo mkdir port_virtual_host2</span><br><span class="line">sudo mkdir port_virtual_host3</span><br><span class="line">sudo touch port_virtual_host1&#x2F;index.html &#96;</span><br><span class="line">sudo cp port_virtual_host1&#x2F;index.html port_virtual_host2</span><br><span class="line">sudo cp port_virtual_host1&#x2F;index.html port_virtual_host3</span><br></pre></td></tr></table></figure>
<p>And then write some codes into all the <code>index.html</code></p>
</li>
<li><p>check whether it works<br>visit <code>localhost:80</code>, <code>localhost:8080</code>,<code>localhost:8081</code></p>
</li>
</ol>
<ul>
<li><strong>Virtual host based on  Server name</strong></li>
</ul>
<ol>
<li>we need to modify <code>nginx.conf</code> by adding more server blocks because one server block corresponds to one virtual host.</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">worker_processes  auto;</span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application&#x2F;octet-stream;</span><br><span class="line">    sendfile        on;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  www.nginx_test1.com;</span><br><span class="line"></span><br><span class="line">        location &#x2F; &#123;</span><br><span class="line">            root   html&#x2F;servername_1;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page   500 502 503 504  &#x2F;50x.html;</span><br><span class="line">        location &#x3D; &#x2F;50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  www.nginx_test2.com;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        location &#x2F; &#123;</span><br><span class="line">            root   html&#x2F;servername_2;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page   500 502 503 504  &#x2F;50x.html;</span><br><span class="line">        location &#x3D; &#x2F;50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>After that, we need to reload the config file</p>
<ol>
<li><p>mofify local host file<br>we need to open the host file firstly <code>sudo atom /etc/hosts</code><br>And then add the mapping from server name to ip address</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$myipaddress www.nginx_test1.com</span><br><span class="line">$myipaddress www.nginx_test2.com</span><br></pre></td></tr></table></figure>
</li>
<li><p>make the <code>index.html</code> for each virtual host</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;html</span><br><span class="line">sudo mkdir servername_1</span><br><span class="line">sudo mkdir servername_2</span><br><span class="line">sudo touch servername_1&#x2F;index.html &#96;</span><br><span class="line">sudo cp servername_1&#x2F;index.html servername_2</span><br></pre></td></tr></table></figure>
<p>And then write some codes into all the <code>index.html</code></p>
</li>
<li><p>check our setting is successfully<br>visit <code>www.nginx_test1.com</code> and <code>www.nginx_test2.com</code></p>
</li>
</ol>
<ul>
<li><strong>Details of server_name directive</strong></li>
</ul>
<ol>
<li>how to use <code>server_name</code></li>
</ol>
<p><code>server_name name1 name2  ...;</code><br>Server names can include an asterisk <code>(“*”)</code> replacing the first or last part of a name:<br><code>server {
    server_name example.com *.example.com www.example.*;
}</code><br>It is also possible to use regular expressions in server names, preceding the name with a tilde (“~”):<br><code>server {
    server_name www.example.com ~^www\d+\.example\.com$;
}</code></p>
<ol>
<li>match priority</li>
</ol>
<p>In some cases, we could find match matched server_name. For example, we have the <code>nginx.conf</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  server_name www.nginx.org</span><br><span class="line">&#125;</span><br><span class="line">server&#123;</span><br><span class="line">  server_name www.nginx.*</span><br><span class="line">&#125;</span><br><span class="line">server&#123;</span><br><span class="line">  server_name *.nginx.org</span><br><span class="line">&#125;</span><br><span class="line">server&#123;</span><br><span class="line">  server_name ~^www\d+\.nginx\.com$;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>If the request from <code>www.nginx.org</code>,which one it will match.<br>Actually, there is match priority.</p>
<ol>
<li>exact name</li>
<li>longest wildcard name starting with an asterisk, e.g. <code>*.example.org</code></li>
<li>longest wildcard name ending with an asterisk, e.g. <code>mail.*</code></li>
<li>first matching regular expression (in order of appearance in a configuration file)</li>
</ol>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2021-09-02T01:25:00.000Z" title="2021-09-02T01:25:00.000Z">2021-09-01</time><span class="level-item"> lawiet019 </span><span class="level-item"><a class="link-muted" href="/categories/technology/">technology</a></span><span class="level-item">7 minutes read (About 1014 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/09/01/notes-of-nginx-learning-4/">notes of nginx learning (4)</a></h1><div class="content"><ul>
<li><strong>Configuration parameters for Nginx compilation and installation</strong></li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>parameter</th>
<th>meaning</th>
<th>default value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>–prefix=*path*</code></td>
<td>Specify the installation directory</td>
<td><code>/usr/local/nginx</code></td>
</tr>
<tr>
<td><code>–sbin-path=*path*</code></td>
<td>sets the name of an NGINX executable file. This name is used only during installation.</td>
<td><code>prefix/sbin/nginx.</code></td>
</tr>
<tr>
<td><code>–conf-path=*path*</code></td>
<td>sets the name of an nginx.conf configuration file</td>
<td><code>prefix/conf/nginx.conf</code></td>
</tr>
<tr>
<td><code>–pid-path=*path*</code></td>
<td>sets the name of an nginx.pid file that will store the process ID of the main process.</td>
<td><code>prefix/logs/nginx.pid</code></td>
</tr>
<tr>
<td><code>–error-log-path=*path*</code></td>
<td>sets the name of the primary error, warnings, and diagnostic file.</td>
<td><code>prefix/logs/error.log.</code></td>
</tr>
<tr>
<td><code>–http-log-path=*path*</code></td>
<td>sets the name of the primary request log file of the HTTP server.</td>
<td><code>prefix/logs/access.log</code></td>
</tr>
<tr>
<td><code>–user=*name*</code></td>
<td>sets the name of an unprivileged user whose credentials will be used by worker processes.</td>
<td>nobody</td>
</tr>
<tr>
<td><code>–group=*name*</code></td>
<td>sets the name of a group whose credentials will be used by worker processes.</td>
<td>a group name is set to the name of an unprivileged user</td>
</tr>
<tr>
<td><code>–with-pcre=*path*</code></td>
<td>sets the path to the sources of the PCRE library. The library is required for regular expressions support in the location directive and for the ngx_http_rewrite_module.</td>
<td></td>
</tr>
<tr>
<td><code>–with-zlib=*path*</code></td>
<td>sets the path to the sources of the zlib library.The library is required for the ngx_http_gzip_module.</td>
</tr>
</tbody>
</table>
</div>
<p>The parameter <code>--with-$module</code> is to add the module when compiling while <code>--without-$module</code> is compiling without that module. The default situation is without.</p>
<ul>
<li><strong>Install and configure nginx in Mac os</strong></li>
</ul>
<ol>
<li>Download the source package<br>Nginx <a href="http://nginx.org/en/download.html">http://nginx.org/en/download.html</a><br>zlib <a href="http://zlib.net/">http://zlib.net/</a><br>pcre <a href="http://www.pcre.org/">http://www.pcre.org/</a><br>openssl <a href="https://www.openssl.org/source/">https://www.openssl.org/source/</a></li>
</ol>
<p>note: for pcre, we don’t use pcre2. Otherwise, we will meet the error <code>src/core/ngx_regex.h:15:10: fatal error: &#39;pcre.h&#39; file not found</code></p>
<ol>
<li><p>unzip the package</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tar xf nginx-1.21.1.tar.gz</span><br><span class="line">tar xf pcre-8.45.tar.gz</span><br><span class="line">tar xf zlib-1.2.11.tar.gz</span><br><span class="line">tar xf openssl-1.1.1l.tar.gz</span><br></pre></td></tr></table></figure>
<p>Now we can see the configuration file <code>nginx-1.21.1/</code><br>And to see the parameters of configuration we could</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd nginx-1.21.1.tar.gz</span><br><span class="line">.&#x2F;configure --help</span><br></pre></td></tr></table></figure>
<p>understand the configure script<br><a href="https://en.wikipedia.org/wiki/Configure_script">https://en.wikipedia.org/wiki/Configure_script</a></p>
</li>
<li><p>compile and install Nginx</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;configure  --with-zlib&#x3D;..&#x2F;zlib-1.2.11 --with-pcre&#x3D;..&#x2F;pcre-8.45 --with-openssl&#x3D;..&#x2F;openssl-1.1.1l</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>And we see the configuration summary like that<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Configuration summary</span><br><span class="line">  + using PCRE library: ..&#x2F;pcre-8.45</span><br><span class="line">  + using OpenSSL library: ..&#x2F;openssl-1.1.1l</span><br><span class="line">  + using zlib library: ..&#x2F;zlib-1.2.11</span><br><span class="line"></span><br><span class="line">  nginx path prefix: &quot;&#x2F;usr&#x2F;local&#x2F;nginx&quot;</span><br><span class="line">  nginx binary file: &quot;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx&quot;</span><br><span class="line">  nginx modules path: &quot;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;modules&quot;</span><br><span class="line">  nginx configuration prefix: &quot;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&quot;</span><br><span class="line">  nginx configuration file: &quot;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;nginx.conf&quot;</span><br><span class="line">  nginx pid file: &quot;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;logs&#x2F;nginx.pid&quot;</span><br><span class="line">  nginx error log file: &quot;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;logs&#x2F;error.log&quot;</span><br><span class="line">  nginx http access log file: &quot;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;logs&#x2F;access.log&quot;</span><br><span class="line">  nginx http client request body temporary files: &quot;client_body_temp&quot;</span><br><span class="line">  nginx http proxy temporary files: &quot;proxy_temp&quot;</span><br><span class="line">  nginx http fastcgi temporary files: &quot;fastcgi_temp&quot;</span><br><span class="line">  nginx http uwsgi temporary files: &quot;uwsgi_temp&quot;</span><br><span class="line">  nginx http scgi temporary files: &quot;scgi_temp&quot;</span><br></pre></td></tr></table></figure></p>
<ol>
<li>Run nginx<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;usr&#x2F;local&#x2F;nginx</span><br><span class="line">sudo sbin&#x2F;nginx</span><br></pre></td></tr></table></figure>
Check whether the nginx is successfully started by accessing 127.0.0.1<br>And also we can use <code>ps -ef| grep nginx</code></li>
</ol>
<p>And we could see other command of nginx by <code>sudo  /usr/local/nginx/sbin/nginx -h</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Options:</span><br><span class="line">  -?,-h         : this help</span><br><span class="line">  -v            : show version and exit</span><br><span class="line">  -V            : show version and configure options then exit</span><br><span class="line">  -t            : test configuration and exit</span><br><span class="line">  -T            : test configuration, dump it and exit</span><br><span class="line">  -q            : suppress non-error messages during configuration testing</span><br><span class="line">  -s signal     : send signal to a master process: stop, quit, reopen, reload</span><br><span class="line">  -p prefix     : set prefix path (default: &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;)</span><br><span class="line">  -e filename   : set error log file (default: logs&#x2F;error.log)</span><br><span class="line">  -c filename   : set configuration file (default: conf&#x2F;nginx.conf)</span><br><span class="line">  -g directives : set global directives out of configuration file</span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong>the structure of configuration file</strong><br>we could find the configuration file in <code>/usr/local/nginx/conf/nginx.conf</code></li>
</ul>
<p>The structure of configuration file can be seen as</p>
<ul>
<li><p>main block<br>Configure directives that affect nginx globally. Generally there are user groups running the nginx server, nginx process pid storage paths, log storage paths,importing configuration file , number of worker processes allowed to be generated, etc.</p>
</li>
<li><p>event block<br>Configure the network connections that affect the nginx server or the user. There is a maximum number of connections per process, which event-driven model to pick to handle connection requests, whether to allow multiple network connections to be accepted at the same time, enable serialization of multiple network connections, etc.</p>
</li>
<li><p>http block<br>You can nest multiple server blocks, configure most of the features such as proxy, cache, log definition and third-party module configuration. Such as file introduction, mime-type definition, log customization, whether to use sendfile to transfer files, connection timeout, number of single connection requests, etc.</p>
<ul>
<li>server block<br>Configure virtual host parameters.<br>Each http block can contain multiple server blocks, and each server block is equivalent to a virtual host, which can have multiple hosts jointly providing services, together with a set of services that are logically close to each other externally.</li>
</ul>
</li>
</ul>
<ul>
<li>location block<br>Configure the routing of requests and the processing of various pages</li>
</ul>
<p>we could see the details of directives</p>
<ul>
<li><strong>modify the nginx.conf</strong><br>We could see user permission of nginx.conf by <code>ls -ll</code><br>And to modify it, we need <code>sudo emacs nginx.conf</code></li>
</ul>
<p>To make nginx.conf take effect, we need to reload it by<br><code>sudo /usr/local/nginx/sbin/nginx  -s reload</code></p>
<p>To check the grammer of the config file we could <code>sudo /usr/local/nginx/sbin/nginx -t</code></p>
<ul>
<li><strong>refer</strong><br><a href="https://www.nginx.com/resources/wiki/start/topics/tutorials/installoptions/">https://www.nginx.com/resources/wiki/start/topics/tutorials/installoptions/</a><br><a href="https://www.cnblogs.com/54chensongxia/p/12938929.html#:~:text=Nginx%E7%9A%84%E4%B8%BB%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6,%E9%97%B4%E4%B8%8D%E5%AD%98%E5%9C%A8%E6%AC%A1%E5%BA%8F%E5%85%B3%E7%B3%BB%E3%80%82">https://www.cnblogs.com/54chensongxia/p/12938929.html#:~:text=Nginx%E7%9A%84%E4%B8%BB%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6,%E9%97%B4%E4%B8%8D%E5%AD%98%E5%9C%A8%E6%AC%A1%E5%BA%8F%E5%85%B3%E7%B3%BB%E3%80%82</a><br><a href="http://nginx.org/en/docs/ngx_core_module.html">http://nginx.org/en/docs/ngx_core_module.html</a><br><a href="https://nginx.org/en/docs/dirindex.html">https://nginx.org/en/docs/dirindex.html</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2021-09-02T01:11:00.000Z" title="2021-09-02T01:11:00.000Z">2021-09-01</time><span class="level-item"> lawiet019 </span><span class="level-item"><a class="link-muted" href="/categories/technology/">technology</a></span><span class="level-item">a few seconds read (About 66 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/09/01/notes-of-nginx-learning-3/">notes of nginx learning (3)</a></h1><div class="content"><ul>
<li><p><strong>Nginx modular design</strong><br>High cohesion and low coupling</p>
</li>
<li><p><strong>modular structure</strong></p>
<ul>
<li>core modular<ul>
<li>ngx_core</li>
<li>ngx_errlog</li>
<li>ngx_conf</li>
<li>ngx_events</li>
<li>ngx_epoll</li>
<li>ngx_regex</li>
<li>ngx_event   </li>
</ul>
</li>
<li><p>standard http modular</p>
<ul>
<li>ngx_http_core</li>
<li>ngx_http_charset</li>
<li>others</li>
</ul>
</li>
<li><p>optional http modular</p>
<ul>
<li>ngx_http_gzip</li>
<li>ngx_http_ssl</li>
<li>others</li>
</ul>
</li>
<li><p>mail service modular</p>
<ul>
<li>ngx_mail_core</li>
<li>ngx_mail_pop3</li>
<li>others</li>
</ul>
</li>
<li>third-party service modular<ul>
<li>rds_json_nginx</li>
<li>lua_nginx</li>
<li>others</li>
</ul>
</li>
</ul>
</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2021-08-24T16:30:00.000Z" title="2021-08-24T16:30:00.000Z">2021-08-24</time><span class="level-item"> lawiet019 </span><span class="level-item"><a class="link-muted" href="/categories/technology/">technology</a></span><span class="level-item">4 minutes read (About 549 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/08/24/notes-of-nginx-learning-2/">notes of nginx learning (2)</a></h1><div class="content"><ul>
<li><p><strong>multprocess vs multithread</strong><br>multithread Shared address space</p>
</li>
<li><p><strong>why nginx use mutliprocess rather than vsmultithread</strong><br>need robustness，if one thread ruin the address space, it will ruin the entire multithread program</p>
</li>
<li><p><strong>structure chart of nginx process</strong></p>
</li>
</ul>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">master process  </span><br><span class="line">           cache  manager (CM)</span><br><span class="line">           cache loader(CL)</span><br><span class="line">           worker process 1</span><br><span class="line">           worker process 2</span><br><span class="line">           worker process 3</span><br><span class="line">           ...</span><br></pre></td></tr></table></figure>
<ul>
<li>master process doesn’t  actually handle users’ requests It only manager the monitor the child processes. This design is good for hot deployment.</li>
<li>when developing third-party module, it is better not modify the master process. Because if we cause error in the master process, it will influence the whole nginx.</li>
<li>The communication between the child processes is through shared memory</li>
</ul>
<ul>
<li><strong>Which process can be managed through semaphore</strong> <ul>
<li>master process <ul>
<li>monitor worker process (CHLD)</li>
<li>manage worker process </li>
<li>receive semaphore(TERM,INT,HUP,USE1,USE2,WINCH)</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>semophore</th>
<th>command line</th>
<th>fuction</th>
</tr>
</thead>
<tbody>
<tr>
<td>QUIT</td>
<td><code>kill -3 $pid</code> or <code>kill -s SIGQUIT $pid</code></td>
<td>graceful shutdown</td>
</tr>
<tr>
<td>TERM, INT</td>
<td><code>kill -15 $pid</code></td>
<td>fast shutdown</td>
</tr>
<tr>
<td>HUP</td>
<td><code>kill -1 $pid</code></td>
<td>changing configuration, keeping up with a changed time zone (only for FreeBSD and Linux), starting new worker processes with a new configuration, graceful shutdown of old worker processes</td>
</tr>
<tr>
<td>USR1</td>
<td><code>kill -10 $pid</code></td>
<td>re-opening log files</td>
</tr>
<tr>
<td>USR2</td>
<td><code>kill -12 $pid</code></td>
<td>upgrading an executable file</td>
</tr>
<tr>
<td>WINCH</td>
<td><code>kill -28 $pid</code></td>
<td>graceful shutdown of worker processes</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>worker process<ul>
<li>receive semaphore(TERM,INT,HUP,USE1,USE2,WINCH)</li>
</ul>
</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>semophore</th>
<th>command line</th>
<th>fuction</th>
</tr>
</thead>
<tbody>
<tr>
<td>TERM, INT</td>
<td><code>kill -15 $pid</code></td>
<td>fast shutdown</td>
</tr>
<tr>
<td>QUIT</td>
<td><code>kill -3 $pid</code></td>
<td>graceful shutdown</td>
</tr>
<tr>
<td>HUP</td>
<td><code>kill -1 $pid</code></td>
<td>changing configuration, keeping up with a changed time zone (only for FreeBSD and Linux), starting new worker processes with a new configuration, graceful shutdown of old worker processes</td>
</tr>
<tr>
<td>USR1</td>
<td><code>kill -10 $pid</code></td>
<td>re-opening log files</td>
</tr>
<tr>
<td>USR2</td>
<td><code>kill -12 $pid</code></td>
<td>upgrading an executable file</td>
</tr>
<tr>
<td>WINCH</td>
<td><code>kill -28 $pid</code></td>
<td>abnormal termination for debugging (requires debug_points to be enabled)</td>
</tr>
</tbody>
</table>
</div>
<pre><code>- It is not recommended. Because the master process will monitor all the worker process, if one worker process receive the SIGNTERM semaphore, even though this worker process will shut down, the master process will recreate a new worker process
</code></pre><ul>
<li>commend line <ul>
<li>reload (HUP)</li>
<li>reopen(USE1)</li>
<li>stop(TERM)</li>
<li>quit(QUIT)<br>example:<br><code>nginx -s reload</code><br>It is the same as send semaphore to master process</li>
</ul>
</li>
</ul>
<ul>
<li><strong>reload process in semaphore</strong><ol>
<li>Send HUP semaphore or use reload in command line</li>
<li>Check if the syntax of the configuration file is correct</li>
<li>master process will open new listening port </li>
<li>master process will use the new configuration to generate new worker process(It is possible that old and new exists at the same time)</li>
<li>master process sends the quit semaphore to previous worker process</li>
<li>The old worker process will process the work task and disconnect and quit</li>
</ol>
</li>
</ul>
<ul>
<li><strong>the process of hot upgrading</strong><ol>
<li>replace old nginx file to new nginx file （not change the directory)</li>
<li>send USR2 signal to master process</li>
<li>master process modify the pid file by adding suffix <code>.oldbin</code></li>
<li>master process uses new nginx file to start a new master process<br>(we need to verify that the new master process works well )</li>
<li>sends WINCH signal to  old master make old work processes shut down. It will make the new request go to the new master </li>
<li>ROLLBACK situation: (if the new master process not work) Send HUB signal to old master while sending QUIT to new master</li>
</ol>
</li>
</ul>
<p>-<strong>REFER</strong></p>
<p>course:<a href="https://coding.imooc.com/class/chapter/405.html#Anchor">https://coding.imooc.com/class/chapter/405.html#Anchor</a><br><a href="https://en.wikipedia.org/wiki/Signal_(IPC">https://en.wikipedia.org/wiki/Signal_(IPC</a>)</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2021-08-23T17:42:00.000Z" title="2021-08-23T17:42:00.000Z">2021-08-23</time><span class="level-item"> lawiet019 </span><span class="level-item"><a class="link-muted" href="/categories/technology/">technology</a></span><span class="level-item">a minute read (About 217 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/08/23/notes-of-nginx-learning-1/">notes of  nginx learning (1)</a></h1><div class="content"><ul>
<li><p><strong>what is nginx</strong><br>NGINX is open source software for web serving, reverse proxying, caching, load balancing, media streaming, and more. It started out as a web server designed for maximum performance and stability. In addition to its HTTP server capabilities, NGINX can also function as a proxy server for email (IMAP, POP3, and SMTP) and a reverse proxy and load balancer for HTTP, TCP, and UDP servers.<br>main purpose:</p>
<ul>
<li>High performance static server</li>
<li>reverse proxy<br>what is reverse proxy <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">      http request         </span><br><span class="line">client ------------&gt; nginx --------&gt;http server </span><br><span class="line">       &lt;------------       &lt;--------</span><br><span class="line">                            http response </span><br><span class="line">      imcp&#x2F;pop</span><br><span class="line">      request          </span><br><span class="line">client ------------&gt; nginx --------&gt;mail server </span><br><span class="line">       &lt;------------       &lt;--------</span><br><span class="line">                            imcp&#x2F;pop </span><br><span class="line">                            response</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>why we need nginx</strong></p>
<ul>
<li>Data volume grow, single-core cpu to multicore cpu</li>
<li>Apache is inefficient in processing requests（ not suitable for concurrency,multi-core cpu)</li>
</ul>
</li>
<li><p><strong>Apache vs Nginx</strong> </p>
</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>Apache</th>
<th>Nginx</th>
</tr>
</thead>
<tbody>
<tr>
<td>one process handles one request</td>
<td>one process handles multiple request</td>
</tr>
<tr>
<td>blocking</td>
<td>non-blocking</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><p><strong>Common application scenarios</strong> </p>
<ul>
<li>static resources<br>Provide services through the local file system</li>
<li>reverse proxying （handle dynamic resources)<ul>
<li>high performance of nginx </li>
<li>Cache acceleration</li>
<li>Load Balance</li>
</ul>
</li>
<li>API service<br>OpenResty</li>
</ul>
</li>
<li><p><strong>Advantages of Nginx</strong></p>
<ul>
<li>High concurrency and high performance</li>
<li>Good scalability,Low coupling.</li>
<li>asynchronous non-blocking event-driven model</li>
<li>high reliability</li>
<li>Business continuity（no need to shut down the machine to update the resources)</li>
<li>Allow secondary development</li>
</ul>
</li>
</ul>
<p>course:<a href="https://coding.imooc.com/class/chapter/405.html#Anchor">https://coding.imooc.com/class/chapter/405.html#Anchor</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2021-05-09T04:52:00.000Z" title="2021-05-09T04:52:00.000Z">2021-05-09</time><span class="level-item"> lawiet019 </span><span class="level-item"><a class="link-muted" href="/categories/technology/">technology</a></span><span class="level-item">2 minutes read (About 267 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/05/09/debugging-in-python/">debugging in python</a></h1><div class="content"><p>There are  mainly two ways to debug in python.<br>The  first one is use <code>print</code> directly.<br>The other method is to use <code>ipdb</code></p>
<ul>
<li><p><code>ipdb</code><br>the IPython-enabled Python Debugger, is a third party interative debugger with all pdb’s functionality and adds IPython support for the interactive shell, like tab completion, color support, magic functions and much more.<br>we could use <code>ipdb.set_trace()</code> to insert breakpoint into code directly.</p>
<ul>
<li><p>help</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ipdb&gt; h <span class="comment"># show all the commands</span></span><br><span class="line"></span><br><span class="line">ipdb&gt; h &lt;<span class="built_in">command</span> name&gt; <span class="comment"># show specific info of that command</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>view </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ipdb&gt; l <span class="comment">#The default display is 5 lines before and after the current code position</span></span><br><span class="line"></span><br><span class="line">ipdb&gt; ll <span class="comment"># show all the lines</span></span><br><span class="line"></span><br><span class="line">ipdb&gt; l &lt;line number n1&gt; ,&lt;line number n2&gt; <span class="comment"># show all the lines from line n1 to line n2</span></span><br></pre></td></tr></table></figure></li>
<li>breakpoint<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ipdb&gt; b &lt;line number n1&gt; <span class="comment"># create a breakpoint at line n1</span></span><br><span class="line"></span><br><span class="line">ipdb&gt; <span class="built_in">disable</span> &lt;line number n1&gt; <span class="comment"># disable the  breakpoint at line n1</span></span><br><span class="line"></span><br><span class="line">ipdb&gt; <span class="built_in">enable</span> &lt;line number n1&gt; <span class="comment"># enable the breakpoint at line n1</span></span><br><span class="line"></span><br><span class="line">ipdb&gt; cl &lt;line number n1&gt; <span class="comment"># clear the breakpoint at line n1</span></span><br></pre></td></tr></table></figure></li>
<li><p>execute</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ipdb&gt; n <span class="comment"># n simply continues program execution to the next line in the current method</span></span><br><span class="line"></span><br><span class="line">ipdb&gt; s  <span class="comment"># steps to the very next line of executable code, whether it is inside a called method or just on the next line</span></span><br><span class="line"></span><br><span class="line">ipdb&gt; w <span class="comment"># Print a stack trace, with the most recent frame at the bottom.An arrow indicates the "current frame", which determines the context of most commands. 'bt' is an alias for this command.</span></span><br><span class="line"></span><br><span class="line">ipdb&gt; c <span class="comment"># c continues program execution until another breakpoint is hit or the program execution completes</span></span><br><span class="line"></span><br><span class="line">ipdb&gt; a <span class="comment"># a prints out all the arguments the current function received</span></span><br><span class="line"></span><br><span class="line">ipdb&gt; r <span class="comment"># continues execution until the current function returns</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-12-29T15:37:00.000Z" title="2020-12-29T15:37:00.000Z">2020-12-29</time><span class="level-item"> lawiet019 </span><span class="level-item"><a class="link-muted" href="/categories/technology/">technology</a></span><span class="level-item">6 minutes read (About 935 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/12/29/shortest-path-algorithm/">shortest path algorithm</a></h1><div class="content"><p>When we want to get the shortest from source node to dest node.<br>Here are some ways and corresponding application scenarios.</p>
<h2 id="dijkstra-algorithm"><a href="#dijkstra-algorithm" class="headerlink" title="dijkstra algorithm"></a>dijkstra algorithm</h2><p>-Suitable for:<br>1.single source node shortest path<br>2.the weight cannot be negative </p>
<ul>
<li>implemention<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Graph</span><span class="params">()</span>:</span> </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, vertices)</span>:</span> </span><br><span class="line">        self.V = vertices </span><br><span class="line">        self.graph = [[<span class="number">0</span> <span class="keyword">for</span> column <span class="keyword">in</span> range(vertices)]  </span><br><span class="line">                    <span class="keyword">for</span> row <span class="keyword">in</span> range(vertices)] </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">printSolution</span><span class="params">(self, dist)</span>:</span> </span><br><span class="line">        <span class="keyword">print</span> (<span class="string">"Vertex tDistance from Source"</span>) </span><br><span class="line">        <span class="keyword">for</span> node <span class="keyword">in</span> range(self.V): </span><br><span class="line">            <span class="keyword">print</span> (node, <span class="string">"t"</span>, dist[node]) </span><br><span class="line"></span><br><span class="line">    <span class="comment"># A utility function to find the vertex with  </span></span><br><span class="line">    <span class="comment"># minimum distance value, from the set of vertices  </span></span><br><span class="line">    <span class="comment"># not yet included in shortest path tree </span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minDistance</span><span class="params">(self, dist, sptSet)</span>:</span> </span><br><span class="line"></span><br><span class="line">        <span class="comment"># Initilaize minimum distance for next node </span></span><br><span class="line">        min = sys.maxsize </span><br><span class="line"></span><br><span class="line">        <span class="comment"># Search not nearest vertex not in the  </span></span><br><span class="line">        <span class="comment"># shortest path tree </span></span><br><span class="line">        <span class="keyword">for</span> v <span class="keyword">in</span> range(self.V): </span><br><span class="line">            <span class="keyword">if</span> dist[v] &lt; min <span class="keyword">and</span> sptSet[v] == <span class="literal">False</span>: </span><br><span class="line">                min = dist[v] </span><br><span class="line">                min_index = v </span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> min_index </span><br><span class="line"></span><br><span class="line">    <span class="comment"># Funtion that implements Dijkstra's single source  </span></span><br><span class="line">    <span class="comment"># shortest path algorithm for a graph represented  </span></span><br><span class="line">    <span class="comment"># using adjacency matrix representation </span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dijkstra</span><span class="params">(self, src)</span>:</span> </span><br><span class="line"></span><br><span class="line">        dist = [sys.maxsize] * self.V </span><br><span class="line">        dist[src] = <span class="number">0</span></span><br><span class="line">        sptSet = [<span class="literal">False</span>] * self.V </span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> cout <span class="keyword">in</span> range(self.V): </span><br><span class="line"></span><br><span class="line">            <span class="comment"># Pick the minimum distance vertex from  </span></span><br><span class="line">            <span class="comment"># the set of vertices not yet processed.  </span></span><br><span class="line">            <span class="comment"># u is always equal to src in first iteration </span></span><br><span class="line">            u = self.minDistance(dist, sptSet) </span><br><span class="line"></span><br><span class="line">            <span class="comment"># Put the minimum distance vertex in the  </span></span><br><span class="line">            <span class="comment"># shotest path tree </span></span><br><span class="line">            sptSet[u] = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># Update dist value of the adjacent vertices  </span></span><br><span class="line">            <span class="comment"># of the picked vertex only if the current  </span></span><br><span class="line">            <span class="comment"># distance is greater than new distance and </span></span><br><span class="line">            <span class="comment"># the vertex in not in the shotest path tree </span></span><br><span class="line">            <span class="keyword">for</span> v <span class="keyword">in</span> range(self.V): </span><br><span class="line">                <span class="keyword">if</span> self.graph[u][v] &gt; <span class="number">0</span> <span class="keyword">and</span> \ </span><br><span class="line">                     sptSet[v] == <span class="literal">False</span> <span class="keyword">and</span> \ </span><br><span class="line">                     dist[v] &gt; dist[u] + self.graph[u][v]: </span><br><span class="line">                    dist[v] = dist[u] + self.graph[u][v] </span><br><span class="line"></span><br><span class="line">        self.printSolution(dist) </span><br><span class="line"></span><br><span class="line"><span class="comment"># Driver program </span></span><br><span class="line">g = Graph(<span class="number">9</span>) </span><br><span class="line">g.graph = [[<span class="number">0</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">0</span>], </span><br><span class="line">        [<span class="number">4</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">0</span>], </span><br><span class="line">        [<span class="number">0</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>], </span><br><span class="line">        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], </span><br><span class="line">        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], </span><br><span class="line">        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">14</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>], </span><br><span class="line">        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">6</span>], </span><br><span class="line">        [<span class="number">8</span>, <span class="number">11</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">7</span>], </span><br><span class="line">        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">0</span>] </span><br><span class="line">        ]; </span><br><span class="line"></span><br><span class="line">g.dijkstra(<span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<h2 id="Floyd-algorithm"><a href="#Floyd-algorithm" class="headerlink" title="Floyd algorithm"></a>Floyd algorithm</h2></li>
<li>Suitable for </li>
</ul>
<p>1.shortest distances between every pair of vertices<br>2.cannot deal with negative cycles( because it does not have the shortest path)</p>
<ul>
<li>logic<br><a href="https://www.cnblogs.com/wangyuliang/p/9216365.html">https://www.cnblogs.com/wangyuliang/p/9216365.html</a></li>
<li>implementation</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python Program for Floyd Warshall Algorithm </span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># Number of vertices in the graph </span></span><br><span class="line">V = <span class="number">4</span> </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Define infinity as the large enough value. This value will be </span></span><br><span class="line"><span class="comment"># used for vertices not connected to each other </span></span><br><span class="line">INF  = <span class="number">99999</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># Solves all pair shortest path via Floyd Warshall Algorithm </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">floydWarshall</span><span class="params">(graph)</span>:</span> </span><br><span class="line">  </span><br><span class="line">    <span class="string">""" dist[][] will be the output matrix that will finally </span></span><br><span class="line"><span class="string">        have the shortest distances between every pair of vertices """</span></span><br><span class="line">    <span class="string">""" initializing the solution matrix same as input graph matrix </span></span><br><span class="line"><span class="string">    OR we can say that the initial values of shortest distances </span></span><br><span class="line"><span class="string">    are based on shortest paths considering no  </span></span><br><span class="line"><span class="string">    intermediate vertices """</span></span><br><span class="line">    dist = map(<span class="keyword">lambda</span> i : map(<span class="keyword">lambda</span> j : j , i) , graph) </span><br><span class="line">      </span><br><span class="line">    <span class="string">""" Add all vertices one by one to the set of intermediate </span></span><br><span class="line"><span class="string">     vertices. </span></span><br><span class="line"><span class="string">     ---&gt; Before start of an iteration, we have shortest distances </span></span><br><span class="line"><span class="string">     between all pairs of vertices such that the shortest </span></span><br><span class="line"><span class="string">     distances consider only the vertices in the set  </span></span><br><span class="line"><span class="string">    &#123;0, 1, 2, .. k-1&#125; as intermediate vertices. </span></span><br><span class="line"><span class="string">      ----&gt; After the end of a iteration, vertex no. k is </span></span><br><span class="line"><span class="string">     added to the set of intermediate vertices and the  </span></span><br><span class="line"><span class="string">    set becomes &#123;0, 1, 2, .. k&#125; </span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> range(V): </span><br><span class="line">  </span><br><span class="line">        <span class="comment"># pick all vertices as source one by one </span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(V): </span><br><span class="line">  </span><br><span class="line">            <span class="comment"># Pick all vertices as destination for the </span></span><br><span class="line">            <span class="comment"># above picked source </span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(V): </span><br><span class="line">  </span><br><span class="line">                <span class="comment"># If vertex k is on the shortest path from  </span></span><br><span class="line">                <span class="comment"># i to j, then update the value of dist[i][j] </span></span><br><span class="line">                dist[i][j] = min(dist[i][j] , </span><br><span class="line">                                  dist[i][k]+ dist[k][j] </span><br><span class="line">                                ) </span><br><span class="line">    printSolution(dist) </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># A utility function to print the solution </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">printSolution</span><span class="params">(dist)</span>:</span> </span><br><span class="line">    print(<span class="string">"Following matrix shows the shortest distances\ </span></span><br><span class="line"><span class="string"> between every pair of vertices"</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(V): </span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(V): </span><br><span class="line">            <span class="keyword">if</span>(dist[i][j] == INF): </span><br><span class="line">                print(<span class="string">"%7s"</span> %(<span class="string">"INF"</span>))</span><br><span class="line">            <span class="keyword">else</span>: </span><br><span class="line">                print(<span class="string">"%7d\t"</span> %(dist[i][j])) </span><br><span class="line">            <span class="keyword">if</span> j == V<span class="number">-1</span>: </span><br><span class="line">                print(<span class="string">""</span>)</span><br><span class="line"><span class="comment"># Driver program to test the above program </span></span><br><span class="line"><span class="comment"># Let us create the following weighted graph </span></span><br><span class="line">  <span class="string">""" </span></span><br><span class="line"><span class="string">              10 </span></span><br><span class="line"><span class="string">         (0)-------&gt;(3) </span></span><br><span class="line"><span class="string">          |         /|\ </span></span><br><span class="line"><span class="string">        5 |          | </span></span><br><span class="line"><span class="string">          |          | 1 </span></span><br><span class="line"><span class="string">         \|/         | </span></span><br><span class="line"><span class="string">         (1)-------&gt;(2) </span></span><br><span class="line"><span class="string">              3           </span></span><br><span class="line"><span class="string">  """</span></span><br><span class="line">graph = [[<span class="number">0</span>,<span class="number">5</span>,INF,<span class="number">10</span>], </span><br><span class="line">             [INF,<span class="number">0</span>,<span class="number">3</span>,INF], </span><br><span class="line">             [INF, INF, <span class="number">0</span>,   <span class="number">1</span>], </span><br><span class="line">             [INF, INF, INF, <span class="number">0</span>] </span><br><span class="line">        ] </span><br><span class="line"><span class="comment"># Print the solution </span></span><br><span class="line">floydWarshall(graph); </span><br><span class="line"><span class="comment"># This code is contributed by Nikhil Kumar Singh(nickzuck_007)</span></span><br></pre></td></tr></table></figure>
<h2 id="SPFA"><a href="#SPFA" class="headerlink" title="SPFA"></a>SPFA</h2><ul>
<li>Suitable for :</li>
</ul>
<ol>
<li>graph with negative cycles<br>2.details<br><a href="https://zhuanlan.zhihu.com/p/58727559">https://zhuanlan.zhihu.com/p/58727559</a></li>
<li>implementation</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python3 implementation of SPFA </span></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque </span><br><span class="line">   </span><br><span class="line"><span class="comment"># Graph is stored as vector of vector of pairs </span></span><br><span class="line"><span class="comment"># first element of pair store vertex </span></span><br><span class="line"><span class="comment"># second element of pair store weight </span></span><br><span class="line">graph = [[] <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">100000</span>)] </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Function to add edges in the graph </span></span><br><span class="line"><span class="comment"># connecting a pair of vertex(frm) and weight </span></span><br><span class="line"><span class="comment"># to another vertex(to) in graph </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">addEdge</span><span class="params">(frm, to, weight)</span>:</span> </span><br><span class="line">  </span><br><span class="line">    graph[frm].append([to, weight]) </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Function to prshortest distance from source </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_distance</span><span class="params">(d, V)</span>:</span> </span><br><span class="line">    print(<span class="string">"Vertex"</span>,<span class="string">"\t"</span>,<span class="string">"Distance from source"</span>) </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, V + <span class="number">1</span>): </span><br><span class="line">        print(i,<span class="string">"\t"</span>,d[i]) </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Function to compute the SPF algorithm </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shortestPathFaster</span><span class="params">(S, V)</span>:</span> </span><br><span class="line">  </span><br><span class="line">    <span class="comment"># Create array d to store shortest distance </span></span><br><span class="line">    d = [<span class="number">10</span>**<span class="number">9</span>]*(V + <span class="number">1</span>) </span><br><span class="line">  </span><br><span class="line">    <span class="comment"># Boolean array to check if vertex </span></span><br><span class="line">    <span class="comment"># is present in queue or not </span></span><br><span class="line">    inQueue = [<span class="literal">False</span>]*(V + <span class="number">1</span>) </span><br><span class="line">  </span><br><span class="line">    d[S] = <span class="number">0</span></span><br><span class="line">  </span><br><span class="line">    q = deque() </span><br><span class="line">    q.append(S) </span><br><span class="line">    inQueue[S] = <span class="literal">True</span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">while</span> (len(q) &gt; <span class="number">0</span>): </span><br><span class="line">  </span><br><span class="line">        <span class="comment"># Take the front vertex from Queue </span></span><br><span class="line">        u = q.popleft() </span><br><span class="line">        inQueue[u] = <span class="literal">False</span></span><br><span class="line">  </span><br><span class="line">        <span class="comment"># Relaxing all the adjacent edges of </span></span><br><span class="line">        <span class="comment"># vertex taken from the Queue </span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(graph[u])): </span><br><span class="line">  </span><br><span class="line">            v = graph[u][i][<span class="number">0</span>] </span><br><span class="line">            weight = graph[u][i][<span class="number">1</span>] </span><br><span class="line">  </span><br><span class="line">            <span class="keyword">if</span> (d[v] &gt; d[u] + weight): </span><br><span class="line">                d[v] = d[u] + weight </span><br><span class="line">  </span><br><span class="line">                <span class="comment"># Check if vertex v is in Queue or not </span></span><br><span class="line">                <span class="comment"># if not then append it into the Queue </span></span><br><span class="line">                <span class="keyword">if</span> (inQueue[v] == <span class="literal">False</span>): </span><br><span class="line">                    q.append(v) </span><br><span class="line">                    inQueue[v] = <span class="literal">True</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment"># Print the result </span></span><br><span class="line">    print_distance(d, V) </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Driver code </span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>: </span><br><span class="line">    V = <span class="number">5</span></span><br><span class="line">    S = <span class="number">1</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment"># Connect vertex a to b with weight w </span></span><br><span class="line">    <span class="comment"># addEdge(a, b, w) </span></span><br><span class="line">  </span><br><span class="line">    addEdge(<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>) </span><br><span class="line">    addEdge(<span class="number">2</span>, <span class="number">3</span>, <span class="number">7</span>) </span><br><span class="line">    addEdge(<span class="number">2</span>, <span class="number">4</span>, <span class="number">-2</span>) </span><br><span class="line">    addEdge(<span class="number">1</span>, <span class="number">3</span>, <span class="number">8</span>) </span><br><span class="line">    addEdge(<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>) </span><br><span class="line">    addEdge(<span class="number">3</span>, <span class="number">4</span>, <span class="number">3</span>) </span><br><span class="line">    addEdge(<span class="number">2</span>, <span class="number">5</span>, <span class="number">3</span>) </span><br><span class="line">    addEdge(<span class="number">4</span>, <span class="number">5</span>, <span class="number">-3</span>) </span><br><span class="line">  </span><br><span class="line">    <span class="comment"># Calling shortestPathFaster function </span></span><br><span class="line">    shortestPathFaster(S, V) </span><br><span class="line">  </span><br><span class="line"><span class="comment"># This code is contributed by mohit kumar 29</span></span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-12-24T18:16:00.000Z" title="2020-12-24T18:16:00.000Z">2020-12-24</time><span class="level-item"> lawiet019 </span><span class="level-item"><a class="link-muted" href="/categories/technology/">technology</a></span><span class="level-item">2 minutes read (About 354 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/12/24/check-cycles-in-directed-graph/">check cycles in directed graph</a></h1><div class="content"><p>There are two ways to check whether there are cycles in the directed graph</p>
<h2 id="DFS"><a href="#DFS" class="headerlink" title="DFS"></a>DFS</h2><p>The first methos is use DFS to check whether the node will be visited.<br>One trick is to use visited set to record all the<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">checkCycle1</span><span class="params">(graph)</span>:</span></span><br><span class="line">    in_degrees = dict((u,<span class="number">0</span>) <span class="keyword">for</span> u <span class="keyword">in</span> graph)   <span class="comment">#初始化所有顶点入度为0</span></span><br><span class="line">    num = len(in_degrees)</span><br><span class="line">    <span class="keyword">for</span> u <span class="keyword">in</span> graph:</span><br><span class="line">        <span class="keyword">for</span> v <span class="keyword">in</span> graph[u]:</span><br><span class="line">            in_degrees[v] += <span class="number">1</span>    <span class="comment">#计算每个顶点的入度</span></span><br><span class="line">    start_node = [u <span class="keyword">for</span> u <span class="keyword">in</span> in_degrees <span class="keyword">if</span> in_degrees[u] == <span class="number">0</span>]   <span class="comment"># 筛选入度为0的顶点</span></span><br><span class="line">    visited = set()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">helper</span><span class="params">(n,stack)</span>:</span></span><br><span class="line">        visited.add(n)</span><br><span class="line">        <span class="keyword">if</span> n <span class="keyword">not</span> <span class="keyword">in</span> graph:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">for</span> neighbour <span class="keyword">in</span> graph[n]:</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> n <span class="keyword">in</span> stack:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            <span class="keyword">elif</span> helper(neighbour,stack +[n]):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    flag = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> node <span class="keyword">in</span> start_node:</span><br><span class="line">        <span class="keyword">if</span> node <span class="keyword">not</span> <span class="keyword">in</span> visited:</span><br><span class="line">            visited.add(node)</span><br><span class="line">            <span class="keyword">if</span> helper(node,[]):</span><br><span class="line">                print(<span class="string">"there is a cycle "</span>)</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">    print(<span class="string">"there is no cycle"</span>)</span><br><span class="line">checkCycle1(&#123;<span class="number">1</span>:[<span class="number">2</span>],<span class="number">2</span>:[<span class="number">3</span>],<span class="number">3</span>:[]&#125;)</span><br></pre></td></tr></table></figure></p>
<h2 id="Topological-sorting"><a href="#Topological-sorting" class="headerlink" title="Topological sorting"></a>Topological sorting</h2><p>To see the detail about Topological sorting can be seen in <a href="/2020/07/01/Topological-sorting/" title="Topological-sorting">Topological-sorting</a><br>The code can be seen as follows:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">checkCycle2</span><span class="params">(graph)</span>:</span></span><br><span class="line">    in_degrees = dict((u,<span class="number">0</span>) <span class="keyword">for</span> u <span class="keyword">in</span> graph)   <span class="comment">#初始化所有顶点入度为0</span></span><br><span class="line">    num = len(in_degrees)</span><br><span class="line">    <span class="keyword">for</span> u <span class="keyword">in</span> graph:</span><br><span class="line">        <span class="keyword">for</span> v <span class="keyword">in</span> graph[u]:</span><br><span class="line">            in_degrees[v] += <span class="number">1</span>    <span class="comment">#计算每个顶点的入度</span></span><br><span class="line">    Q = [u <span class="keyword">for</span> u <span class="keyword">in</span> in_degrees <span class="keyword">if</span> in_degrees[u] == <span class="number">0</span>]   <span class="comment"># 筛选入度为0的顶点</span></span><br><span class="line">    Seq = []</span><br><span class="line">    <span class="keyword">while</span> Q:</span><br><span class="line">        u = Q.pop()       <span class="comment">#默认从最后一个删除</span></span><br><span class="line">        Seq.append(u)</span><br><span class="line">        <span class="keyword">for</span> v <span class="keyword">in</span> graph[u]:</span><br><span class="line">            in_degrees[v] -= <span class="number">1</span>    <span class="comment">#移除其所有出边</span></span><br><span class="line">            <span class="keyword">if</span> in_degrees[v] == <span class="number">0</span>:</span><br><span class="line">                Q.append(v)          <span class="comment">#再次筛选入度为0的顶点</span></span><br><span class="line">    <span class="keyword">if</span> len(Seq) == num:       <span class="comment">#输出的顶点数是否与图中的顶点数相等</span></span><br><span class="line">        print(<span class="string">"there is no cycle"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">"there is a cycle"</span>)</span><br><span class="line">checkCycle2(&#123;<span class="number">1</span>:[<span class="number">2</span>],<span class="number">2</span>:[<span class="number">1</span>],<span class="number">3</span>:[]&#125;)</span><br></pre></td></tr></table></figure></p>
<h2 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h2><p><a href="https://zhuanlan.zhihu.com/p/69858335">https://zhuanlan.zhihu.com/p/69858335</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-12-08T04:07:00.000Z" title="2020-12-08T04:07:00.000Z">2020-12-07</time><span class="level-item"> lawiet019 </span><span class="level-item"><a class="link-muted" href="/categories/technology/">technology</a></span><span class="level-item">14 minutes read (About 2055 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/12/07/Multiprocessing-Vs-Threading/">Multiprocessing Vs. Threading</a></h1><div class="content"><h2 id="Multiple-CPUs-vs-multi-core-CPUs"><a href="#Multiple-CPUs-vs-multi-core-CPUs" class="headerlink" title="Multiple CPUs vs multi-core CPUs"></a>Multiple CPUs vs multi-core CPUs</h2><p><a href="https://www.zhihu.com/question/20998226">https://www.zhihu.com/question/20998226</a></p>
<h2 id="process-vs-Threading"><a href="#process-vs-Threading" class="headerlink" title="process vs Threading"></a>process vs Threading</h2><p>one process can have multiple Threadings<br>process has independet memory while threadings share memory<br><a href="https://www.ruanyifeng.com/blog/2013/04/processes_and_threads.html">https://www.ruanyifeng.com/blog/2013/04/processes_and_threads.html</a></p>
<h2 id="multitasking"><a href="#multitasking" class="headerlink" title="multitasking"></a>multitasking</h2><p>Operating system can run multiple tasks at the same time, you are in the browser, while listening to MP3, while in Word to catch up with homework, this is multi-tasking.<br>three modes of multi-tasking:</p>
<ol>
<li>Multiprocessing</li>
<li>Multithreading</li>
<li>Multiprocessing +  Multithreading</li>
</ol>
<h2 id="parallelism-vs-concurrency"><a href="#parallelism-vs-concurrency" class="headerlink" title="parallelism vs concurrency"></a>parallelism vs concurrency</h2><p><strong>Parallelism</strong>: it means that at the same time, multiple instructions are executed on multiple processors at the same time;<br><strong>Concurrency</strong>: at the same time, only one instruction can be executed, but multiple process instructions are executed in rotation, which makes it possible to execute multiple processes at the same time.</p>
<h2 id="Multithreading-in-Python"><a href="#Multithreading-in-Python" class="headerlink" title="Multithreading in Python"></a>Multithreading in Python</h2><p>For Python3, we usually use <code>threading</code> module.<br>One thing we must notice is that threading cannot provide real . The problem is just that it can’t use more than one of the available cores. This is due to something called the GIL(Global Interpreter Lock). Python threads still work for I/O bound tasks as opposed to CPU bound tasks which may cause deadlocks and race conditions. Many Python libraries solve this issue by using C extensions to bypass the GIL. Of course, this is all in the case of CPython.<br>it is much better to use multiprocessing to get the benefit of all the cores. But there are much fewer cores than there are threads. Cores are valuable resources and take up a lot of memory. If you don’t mind dealing with IPC(Interprocess Communication), then it is a great solution.</p>
<ul>
<li><p>What is GIL (Global Interpreter Lock)</p>
<ul>
<li>It is connected with CPython</li>
<li>It ensures that only one Python thread executes at any time</li>
<li>The GIL prevents race conditions and ensures thread safety. A nice explanation of how the GIL helps in these areas can be found here. In short, this mutex is necessary mainly because CPython’s memory management is not thread-safe.<br><a href="https://python3.guide/python-concurrency/the-python-gil">https://python3.guide/python-concurrency/the-python-gil</a></li>
<li><p>mechanism of GIL</p>
<p><img src="/images/pasted-20.png" alt="GIL.png"><br><a href="http://c.biancheng.net/view/5537.html">http://c.biancheng.net/view/5537.html</a></p>
</li>
<li>How to deal with GIL<ul>
<li>Use multiprocessing</li>
<li>Use another  Python implementation except Cpython</li>
<li>C extension programming technology.The main idea is to transfer computationally intensive tasks to C, independent of Python, and release the GIL in the C code while working. This can be done by inserting a special macro like the following in the C code.<br><a href="https://python3-cookbook.readthedocs.io/zh_CN/latest/c12/p09_dealing_with_gil_stop_worring_about_it.html">https://python3-cookbook.readthedocs.io/zh_CN/latest/c12/p09_dealing_with_gil_stop_worring_about_it.html</a></li>
</ul>
</li>
</ul>
</li>
<li><p>the module <code>threading</code><br>an example from <a href="cnblogs.com/lucaq/p/7225166.html">website</a></p>
<ul>
<li>basic example</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">import threading</span><br><span class="line">   import time</span><br><span class="line"></span><br><span class="line">   def foo(n):</span><br><span class="line">       print(&#39;&gt;&gt;&gt;&gt;&gt;%s&#39; %n)</span><br><span class="line">       time.sleep(3)</span><br><span class="line"></span><br><span class="line">   def bar(n):</span><br><span class="line">       time.sleep(5)</span><br><span class="line">       print(&#39;&gt;&gt;&gt;&gt;&gt;%s&#39; %n)</span><br><span class="line"></span><br><span class="line">   s &#x3D; time.time()</span><br><span class="line"></span><br><span class="line">   t1 &#x3D; threading.Thread(target&#x3D;foo,args&#x3D;(2,))</span><br><span class="line">   t1.start()    # .start() - activate  thread</span><br><span class="line"></span><br><span class="line">   t2 &#x3D; threading.Thread(target&#x3D;bar,args&#x3D;(5,))</span><br><span class="line">   t2.setDaemon(True)　　# the main thread doesn&#39;t wait the child thread</span><br><span class="line">   t2.start()</span><br><span class="line"></span><br><span class="line">   t1.join()　　# wait one thread to be completed</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   print(&#39;ending!&#39;)</span><br><span class="line">   print(&#39;cost time:&#39;,time.time()-s)</span><br></pre></td></tr></table></figure>
<ul>
<li>use class</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span><span class="params">(threading.Thread)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name)</span>:</span></span><br><span class="line"></span><br><span class="line">        threading.Thread.__init__(self)</span><br><span class="line">        self.name = name</span><br><span class="line">        <span class="comment"># super().__init__()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'OK'</span>)</span><br><span class="line">        time.sleep(<span class="number">2</span>)</span><br><span class="line">        print(<span class="string">'end'</span>,self.name)</span><br><span class="line"></span><br><span class="line">t1 = MyThread(<span class="string">"t1"</span>)</span><br><span class="line">t1.start()</span><br><span class="line">t2 = MyThread(<span class="string">"t2"</span>)</span><br><span class="line">t2.start()</span><br><span class="line">print(<span class="string">'ending all'</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>lock<br>lock is necessary even though we have GIL. Let we give an example.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">balance = <span class="number">0</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change_it_without_lock</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> balance</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100000</span>):</span><br><span class="line">        print(balance)</span><br><span class="line">        balance = balance + n</span><br><span class="line">        time.sleep(<span class="number">5</span>)</span><br><span class="line">        balance = balance - n</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">threads = [</span><br><span class="line">  threading.Thread(target=change_it_without_lock, args=(<span class="number">8</span>,) ),</span><br><span class="line">  threading.Thread(target=change_it_without_lock, args=(<span class="number">10</span>,) )</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">[t.start() <span class="keyword">for</span> t <span class="keyword">in</span> threads]</span><br><span class="line">[t.join() <span class="keyword">for</span> t <span class="keyword">in</span> threads]</span><br></pre></td></tr></table></figure>
<p>   From the unlock version, we will get value like 8,10</p>
<p>   We could use mutex in the following case<br>   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">balance = <span class="number">0</span></span><br><span class="line">lock = threading.Lock()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change_it_without_lock</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> balance</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100000</span>):</span><br><span class="line">        print(balance)</span><br><span class="line">        lock.acquire()</span><br><span class="line">        balance = balance + n</span><br><span class="line">        time.sleep(<span class="number">5</span>)</span><br><span class="line">        balance = balance - n</span><br><span class="line">        lock.release()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">threads = [</span><br><span class="line">  threading.Thread(target=change_it_without_lock, args=(<span class="number">8</span>,) ),</span><br><span class="line">  threading.Thread(target=change_it_without_lock, args=(<span class="number">10</span>,) )</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">[t.start() <span class="keyword">for</span> t <span class="keyword">in</span> threads]</span><br><span class="line">[t.join() <span class="keyword">for</span> t <span class="keyword">in</span> threads]</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>recursive lock<br>Mutex can be divided into recursive lock and non recursive lock. Recursive lock is also called reentrant lock, and non recursive lock is also called non reentrant lock.<br>The same thread can acquire the same recursive lock multiple times without deadlock. If a thread acquires the same non recursive lock multiple times, a deadlock will occur.<br><a href="https://stackoverflow.com/questions/22885775/what-is-the-difference-between-lock-and-rlock">why we need Rlock</a></p>
</li>
<li><p>Semaphore<br>mutex is special case of Semaphore with value 1</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">import</span> threading</span><br><span class="line"> <span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">semaphore = threading.Semaphore(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">    semaphore.acquire()</span><br><span class="line">    print(<span class="string">'OK'</span>)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    semaphore.release()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">    t = threading.Thread(target=foo,args=())</span><br><span class="line">    t.start()</span><br></pre></td></tr></table></figure></li>
<li><p>Condition</p>
<p>The typical programming style using condition variables uses the lock to synchronize access to some shared state; threads that are interested in a particular change of state call wait() repeatedly until they see the desired state, while threads that modify the state call notify() or notify_all() when they change the state in such a way that it could possibly be a desired state for one of the waiters.<br>Here are functions:</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   acquire(*args) - Acquire the underlying lock. </span><br><span class="line">   </span><br><span class="line">   release()- Release the underlying lock. </span><br><span class="line">   </span><br><span class="line">   wait(timeout&#x3D;None)- Wait until notified or until a timeout occurs. If the calling thread has not acquired the lock when this method is called, a RuntimeError is raised.</span><br><span class="line">   </span><br><span class="line">   wait_for(predicate, timeout&#x3D;None)- Wait until a condition evaluates to true. predicate should be a callable which result will be interpreted as a boolean value. A timeout may be provided giving the maximum time to wait.</span><br><span class="line">   </span><br><span class="line">   notify(n&#x3D;1) - By default, wake up one thread waiting on this condition, if any. If the calling thread has not acquired the lock when this method is called, a RuntimeError is raised.</span><br><span class="line">   </span><br><span class="line">   notify_all()</span><br><span class="line">Wake up all threads waiting on this condition. This method acts like notify(), but wakes up all waiting threads instead of one. If the calling thread has not acquired the lock when this method is called, a RuntimeError is raised.</span><br></pre></td></tr></table></figure>
<p>   Here is an example of condition Leetcode 1188. Design Bounded Blocking Queue</p>
<ul>
<li>Event<br>The event of threading is used to control the execution of other threads by the main thread. The event mainly provides three methods: wait, clear and set.<br>Event handling mechanism: a “flag” is defined globally. If the value of “flag” is false, then when the program executes event.wait  Method, if the flag value is true, then event.wait  Method is not blocked.<br>Here are some common functions:<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">event.wait (timeout = none): the thread calling the method will be blocked. If the timeout parameter <span class="keyword">is</span> set, the thread will stop blocking <span class="keyword">and</span> <span class="keyword">continue</span> to execute after timeout;</span><br><span class="line">event.set (): <span class="keyword">if</span> the flag of event <span class="keyword">is</span> set to true, all threads calling the wait method will be awakened;</span><br><span class="line">event.clear (): <span class="keyword">if</span> the flag of event <span class="keyword">is</span> set to false, all threads calling the wait method will be blocked;</span><br><span class="line">event.isSet (): judge whether the flag of event <span class="keyword">is</span> true.</span><br></pre></td></tr></table></figure>
Here is an application of it.<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading,time</span><br><span class="line"></span><br><span class="line">event = threading.Event() <span class="comment"># default value is false</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> event.is_set():</span><br><span class="line">        print(<span class="string">'wait.....'</span>)</span><br><span class="line">        event.wait(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">        print(<span class="string">'Connect to redis server'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">    t = threading.Thread(target=foo,args=())</span><br><span class="line">    t.start()</span><br><span class="line"></span><br><span class="line">print(<span class="string">'attempt to start redis server'</span>)</span><br><span class="line">time.sleep(<span class="number">10</span>)</span><br><span class="line">event.set()     <span class="comment"># set the flag as True</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="multiprocessing-in-python"><a href="#multiprocessing-in-python" class="headerlink" title="multiprocessing in python"></a>multiprocessing in python</h2><p>Unlike multithreading, The multiprocessing in Python is real.We always use <code>multiprocessing</code>.<br>Let we look at it:</p>
<ul>
<li>basic exmaple </li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(name)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        print(<span class="string">" the child %s with pid run：%s"</span>%(name,os.getpid())) </span><br><span class="line">        print(<span class="string">"the id of the parent is %d"</span>%os.getppid())</span><br><span class="line">        time.sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    print(<span class="string">"the parent process %d starts"</span> % os.getpid())</span><br><span class="line">    <span class="comment"># create the child process and pass new arguments</span></span><br><span class="line">    p = Process(target=run, args=(<span class="string">"Ail"</span>,)) </span><br><span class="line">    p.start()  <span class="comment"># start child process </span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        print(<span class="string">"this is forever loop for see process status"</span>)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>The output is like </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">the parent process 20686 starts</span><br><span class="line">this is forever loop for see process status</span><br><span class="line">the child Ail with pid run：20687</span><br><span class="line">the id of the parent is 20686</span><br></pre></td></tr></table></figure>
<p>We could use command <code>ps aux | egrep &#39;(python)&#39;</code><br>We could see script like that<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">koko             20687   0.0  0.0  4284264   1312 s001  S+    7:25PM   0:00.08 python &#x2F;Users&#x2F;koko&#x2F;Documents&#x2F;prep&#x2F;blog&#x2F;test.py</span><br><span class="line">koko             20686   0.0  0.0  4284264   2900 s001  S+    7:25PM   0:00.16 python &#x2F;Users&#x2F;koko&#x2F;Documents&#x2F;prep&#x2F;blog&#x2F;test.py</span><br></pre></td></tr></table></figure></p>
<ul>
<li><code>join</code> function - make  parent process wait the child process to end</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"child process starts"</span>)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    print(<span class="string">"child process ends"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    print(<span class="string">"parent process starts"</span>)</span><br><span class="line">    p = Process(target=run)</span><br><span class="line">    p.start()</span><br><span class="line">    p.join()  <span class="comment"># wait children process </span></span><br><span class="line">    print(<span class="string">"parent process ends"</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>Pool</code></p>
<p>to handle lots of child process </p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> multiprocessing.pool <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep, time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(name)</span>:</span></span><br><span class="line">    print(<span class="string">"child process named %s starts,and its ID is %d"</span> % (name, os.getpid()))</span><br><span class="line">    start = time()</span><br><span class="line">    sleep(random.choice([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]))</span><br><span class="line">    end = time()</span><br><span class="line">    print(<span class="string">"child process named %s starts,and its ID is %d. It spend times .2%f"</span> % (name, os.getpid(), end-start))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    print(<span class="string">"parent process starts"</span>)</span><br><span class="line">    <span class="comment"># set size of pool, the default value is the number of cores </span></span><br><span class="line">    p = Pool(<span class="number">8</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        <span class="comment"># put into pool</span></span><br><span class="line">        p.apply_async(run, args=(i,))</span><br><span class="line">    <span class="comment"># we must call close before join and close will let all no other process can joined</span></span><br><span class="line">    p.close()</span><br><span class="line">    <span class="comment"># wait all the child  process to end </span></span><br><span class="line">    p.join()</span><br><span class="line">    print(<span class="string">"parent process ends"</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>the Communication of child process and parent process </p>
<p>They cannot share the global variable. We will use <code>Queue</code> in <code>multiprocessing</code>. Queue will offer methods to write and read.<br>Both end of queue can read and write.Here is an example</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process, Queue</span><br><span class="line"><span class="keyword">import</span> os, time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">child1</span><span class="params">(w_value,q)</span>:</span></span><br><span class="line">    q.put(w_value) </span><br><span class="line">    r = q.get()<span class="comment"># it will block</span></span><br><span class="line">    print(<span class="string">"child 1 read"</span>,r)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">child2</span><span class="params">(w_value,q)</span>:</span></span><br><span class="line">    r = q.get()</span><br><span class="line">    print(<span class="string">"child 2 read "</span>,r)</span><br><span class="line">    q.put(w_value)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">  </span><br><span class="line">    q = Queue()</span><br><span class="line">    c1 = Process(target=child1, args=(<span class="number">1</span>,q,))</span><br><span class="line">    c2 = Process(target=child2, args=(<span class="number">2</span>,q,))</span><br><span class="line">    c1.start()</span><br><span class="line">    c2.start()</span><br></pre></td></tr></table></figure>
<p>   other functions in queue </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Queue.qsize() # return the size of queue   </span><br><span class="line">Queue.empty() # check wether the queue is empty   </span><br><span class="line">Queue.get_nowait() # Return an item if one is immediately available, else raise QueueEmpty.</span><br></pre></td></tr></table></figure>
<p>  Another class <a href="https://docs.python.org/3/library/multiprocessing.html">Pipe</a> can be used for this too.</p>
<p>  Also <code>shared memory</code> can be used to handle this problem.<br>    Data can be stored in a shared memory map using <code>Value</code> or <code>Array</code>. For example, the following code</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process, Value, Array</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(n, a)</span>:</span></span><br><span class="line">    n.value = <span class="number">3.1415927</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(a)):</span><br><span class="line">        a[i] = -a[i]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    num = Value(<span class="string">'d'</span>, <span class="number">0.0</span>)</span><br><span class="line">    arr = Array(<span class="string">'i'</span>, range(<span class="number">10</span>))</span><br><span class="line"></span><br><span class="line">    p = Process(target=f, args=(num, arr))</span><br><span class="line">    p.start()</span><br><span class="line">    p.join()</span><br><span class="line"></span><br><span class="line">    print(num.value)</span><br><span class="line">    print(arr[:])</span><br></pre></td></tr></table></figure>
<ul>
<li><p>Lock </p>
<p>we could use a lock to ensure Synchronization</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process, Lock</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(l, i)</span>:</span></span><br><span class="line">    l.acquire()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        print(<span class="string">'hello world'</span>, i)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        l.release()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    lock = Lock()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        Process(target=f, args=(lock, num)).start()</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>other functions <ul>
<li>count the number of core of computers<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">'the number of cores is '</span> + str(multiprocessing.cpu_count()))</span><br></pre></td></tr></table></figure></li>
<li>All currently running  child processes<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">import</span> os </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(name)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        print(<span class="string">" the child %s with pid run：%s"</span>%(name,os.getpid()))</span><br><span class="line">        print(<span class="string">"the id of the parent is %d"</span>%os.getppid())</span><br><span class="line">        time.sleep(<span class="number">2</span>)</span><br><span class="line">p = Process(target=run, args=(<span class="string">"Ail"</span>,))</span><br><span class="line">p.start()</span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> multiprocessing.active_children():</span><br><span class="line">        print(<span class="string">'the child process name is  '</span> + p.name + <span class="string">' id: '</span> + str(p.pid))</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h2 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h2><p><a href="https://stackoverflow.com/questions/44793371/is-multithreading-in-python-a-myth#:~:text=No%2C%20Python%20does%20have%20multithreading,GIL(Global%20Interpreter%20Lock">https://stackoverflow.com/questions/44793371/is-multithreading-in-python-a-myth#:~:text=No%2C%20Python%20does%20have%20multithreading,GIL(Global%20Interpreter%20Lock</a>).<br><a href="http://c.biancheng.net/view/5537.html">http://c.biancheng.net/view/5537.html</a><br><a href="https://python3-cookbook.readthedocs.io/zh_CN/latest/c12/p09_dealing_with_gil_stop_worring_about_it.html">https://python3-cookbook.readthedocs.io/zh_CN/latest/c12/p09_dealing_with_gil_stop_worring_about_it.html</a><br><a href="https://www.jianshu.com/p/a5f10c152c20">https://www.jianshu.com/p/a5f10c152c20</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-11-27T05:09:00.000Z" title="2020-11-27T05:09:00.000Z">2020-11-27</time><span class="level-item"> lawiet019 </span><span class="level-item"><a class="link-muted" href="/categories/technology/">technology</a></span><span class="level-item">a minute read (About 155 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/11/27/application-of-binary-search/">application of binary search</a></h1><div class="content"><h2 id="some-common-applications-of-binary-search"><a href="#some-common-applications-of-binary-search" class="headerlink" title="some common applications of binary search"></a>some common applications of binary search</h2><p>Since I always make mistakes on the while loop of binary search, I list the codes for common scenario.</p>
<ul>
<li>find the exact value </li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">binarySearch</span><span class="params">(arr,target)</span>:</span></span><br><span class="line">    arr.sort()</span><br><span class="line">    left = <span class="number">0</span></span><br><span class="line">    right = len(arr)<span class="number">-1</span></span><br><span class="line">    <span class="keyword">while</span> left &lt;= right:</span><br><span class="line">        mid = (left + right) //<span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> arr[mid] == target:</span><br><span class="line">            <span class="keyword">return</span> mid</span><br><span class="line">        <span class="keyword">elif</span> arr[mid] &gt; target:</span><br><span class="line">            right = mid <span class="number">-1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            left = mid +<span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br></pre></td></tr></table></figure>
<ul>
<li>find the closet value </li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findClosetElement</span><span class="params">(arr,target)</span>:</span></span><br><span class="line">    arr.sort()</span><br><span class="line">    left = <span class="number">0</span></span><br><span class="line">    right = len(arr)<span class="number">-1</span></span><br><span class="line">    <span class="keyword">if</span> target &gt;=arr[<span class="number">-1</span>]:</span><br><span class="line">        <span class="keyword">return</span>  right</span><br><span class="line">    <span class="keyword">if</span> target &lt;= arr[<span class="number">0</span>]:</span><br><span class="line">        <span class="keyword">return</span> left</span><br><span class="line">    <span class="keyword">while</span> right - left &gt;<span class="number">1</span>:</span><br><span class="line">        mid = (right + left)//<span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> arr[mid] == target:</span><br><span class="line">            <span class="keyword">return</span> mid</span><br><span class="line">        <span class="keyword">elif</span> arr[mid] &gt; target:</span><br><span class="line">            right = mid</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            left = mid</span><br><span class="line">    <span class="keyword">return</span> left <span class="keyword">if</span> abs(arr[left] - target) &lt; abs(arr[right] - target) <span class="keyword">else</span> right</span><br></pre></td></tr></table></figure>
<ul>
<li>find the maximum value less than the target</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findMax</span><span class="params">(arr,target)</span>:</span></span><br><span class="line">    arr.sort()</span><br><span class="line">    left = <span class="number">0</span></span><br><span class="line">    right = len(arr) <span class="number">-1</span></span><br><span class="line">    <span class="keyword">while</span> left &lt; right:</span><br><span class="line">        mid = (left + right)//<span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> arr[mid]&gt;= target:</span><br><span class="line">            right = mid <span class="number">-1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            left  = mid +<span class="number">1</span></span><br></pre></td></tr></table></figure>
</div></article></div><nav class="pagination is-centered mt-4" role="navigation" aria-label="pagination"><div class="pagination-previous is-invisible is-hidden-mobile"><a href="/page/0/">Previous</a></div><div class="pagination-next"><a href="/page/2/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link is-current" href="/">1</a></li><li><a class="pagination-link" href="/page/2/">2</a></li><li><a class="pagination-link" href="/page/3/">3</a></li><li><a class="pagination-link" href="/page/4/">4</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="is-rounded" src="/img/avatar.jpeg" alt="koko"></figure><p class="title is-size-4 is-block line-height-inherit">koko</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Troy, NY</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">33</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">3</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">22</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/lawiet019" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/lawiet019"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/math/"><span class="level-start"><span class="level-item">math</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/technology/"><span class="level-start"><span class="level-item">technology</span></span><span class="level-end"><span class="level-item tag">28</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/technology/math/"><span class="level-start"><span class="level-item">math</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li></ul></div></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">Recent</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2021-09-02T01:32:00.000Z">2021-09-01</time></p><p class="title is-6"><a class="link-muted" href="/2021/09/01/notes-of-nginx-learning-5/">notes of nginx learning (5)</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-09-02T01:25:00.000Z">2021-09-01</time></p><p class="title is-6"><a class="link-muted" href="/2021/09/01/notes-of-nginx-learning-4/">notes of nginx learning (4)</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/technology/">technology</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-09-02T01:11:00.000Z">2021-09-01</time></p><p class="title is-6"><a class="link-muted" href="/2021/09/01/notes-of-nginx-learning-3/">notes of nginx learning (3)</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/technology/">technology</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-08-24T16:30:00.000Z">2021-08-24</time></p><p class="title is-6"><a class="link-muted" href="/2021/08/24/notes-of-nginx-learning-2/">notes of nginx learning (2)</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/technology/">technology</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-08-23T17:42:00.000Z">2021-08-23</time></p><p class="title is-6"><a class="link-muted" href="/2021/08/23/notes-of-nginx-learning-1/">notes of  nginx learning (1)</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/technology/">technology</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2021/09/"><span class="level-start"><span class="level-item">September 2021</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/08/"><span class="level-start"><span class="level-item">August 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/05/"><span class="level-start"><span class="level-item">May 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/12/"><span class="level-start"><span class="level-item">December 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/11/"><span class="level-start"><span class="level-item">November 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/10/"><span class="level-start"><span class="level-item">October 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/08/"><span class="level-start"><span class="level-item">August 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/07/"><span class="level-start"><span class="level-item">July 2020</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/06/"><span class="level-start"><span class="level-item">June 2020</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/05/"><span class="level-start"><span class="level-item">May 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/C/"><span class="tag">C++</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Graph/"><span class="tag">Graph</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/algorithm/"><span class="tag">algorithm</span><span class="tag is-grey-lightest">12</span></a></div><div class="control"><a class="tags has-addons" href="/tags/binary-search/"><span class="tag">binary search</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bit-manipulation/"><span class="tag">bit manipulation</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/collections/"><span class="tag">collections</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/computing/"><span class="tag">computing</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/debug/"><span class="tag">debug</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dynamic-programming/"><span class="tag">dynamic programming</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/graph/"><span class="tag">graph</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hexo/"><span class="tag">hexo</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/learning-note/"><span class="tag">learning note</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/linked-list/"><span class="tag">linked list</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/multiprocess/"><span class="tag">multiprocess</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/multithread/"><span class="tag">multithread</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nginx/"><span class="tag">nginx</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/python/"><span class="tag">python</span><span class="tag is-grey-lightest">21</span></a></div><div class="control"><a class="tags has-addons" href="/tags/regular-expression/"><span class="tag">regular expression</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sort/"><span class="tag">sort</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sorting/"><span class="tag">sorting</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tool/"><span class="tag">tool</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tree/"><span class="tag">tree</span><span class="tag is-grey-lightest">1</span></a></div></div></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe to Updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="Subscribe"></div></div></form></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/favicon.png" alt="lawilet&#039;s website" height="28"></a><p class="size-small"><span>&copy; 2021 lawiet019</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'http://law-liet.com',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to Top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>