<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>notes of nginx learning (10) - lawilet&#039;s website</title><meta description="what is Reverse proxy server   what is Reverse proxy server  The reverse proxy server is located between the user and the actual server and provides a relay service for requests and responses.For the"><meta property="og:type" content="blog"><meta property="og:title" content="notes of nginx learning (10)"><meta property="og:url" content="http://law-liet.com/2021/09/15/notes-of-nginx-learning-10/"><meta property="og:site_name" content="lawilet&#039;s website"><meta property="og:description" content="what is Reverse proxy server   what is Reverse proxy server  The reverse proxy server is located between the user and the actual server and provides a relay service for requests and responses.For the"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://law-liet.com/img/og_image.png"><meta property="article:published_time" content="2021-09-15T19:00:00.000Z"><meta property="article:modified_time" content="2021-09-15T19:02:27.644Z"><meta property="article:author" content="lawiet019"><meta property="article:tag" content="nginx"><meta property="article:tag" content="learning note"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://law-liet.com/2021/09/15/notes-of-nginx-learning-10/"},"headline":"lawilet's website","image":["http://law-liet.com/img/og_image.png"],"datePublished":"2021-09-15T19:00:00.000Z","dateModified":"2021-09-15T19:02:27.644Z","author":{"@type":"Person","name":"lawiet019"},"description":"what is Reverse proxy server   what is Reverse proxy server  The reverse proxy server is located between the user and the actual server and provides a relay service for requests and responses.For the"}</script><link rel="canonical" href="http://law-liet.com/2021/09/15/notes-of-nginx-learning-10/"><link rel="icon" href="/img/favicon.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/favicon.png" alt="lawilet&#039;s website" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/lawiet019"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2021-09-15T19:00:00.000Z" title="2021-09-15T19:00:00.000Z">2021-09-15</time><span class="level-item"> lawiet019 </span><span class="level-item"><a class="link-muted" href="/categories/technology/">technology</a></span><span class="level-item">17 minutes read (About 2530 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">notes of nginx learning (10)</h1><div class="content"><ul>
<li><strong>what is Reverse proxy server</strong></li>
</ul>
<ol>
<li>what is Reverse proxy server</li>
</ol>
<p>The reverse proxy server is located between the user and the actual server and provides a relay service for requests and responses.<br>For the user, access to the reverse proxy server is access to the actual server.<br>Reverse proxy can reduce server load consumption and increase efficiency</p>
<ol>
<li>the advantages of reverse proxy server<ul>
<li>hide the actual server</li>
<li>Horizontal expansion of back-end dynamic services</li>
<li>Separation of dynamic resources and static resources to improve system robustness</li>
</ul>
</li>
</ol>
<ul>
<li><strong>Dynamic and Static Separation</strong></li>
</ul>
<p>Deploy static website resources (HTML, JavaScript, CSS, img, etc.) separately from backend applications to improve the speed of user access to static code and reduce access to backend applications<br>One approach is to deploy the static resources on nginx(sometimes we could put static resources on CDN), and the backend project to the application server.</p>
<ul>
<li><strong>Supported protocols when using Nginx as a reverse proxy</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># transportation layer</span><br><span class="line">client-----&gt; nginx -----&gt; server</span><br><span class="line">      tcp           tcp</span><br><span class="line">      udp           udp</span><br><span class="line"></span><br><span class="line">client-----&gt; nginx -----&gt; server</span><br><span class="line">      http         fastcgi</span><br><span class="line">                   scgi</span><br><span class="line">                   uwsgi</span><br><span class="line">                   http</span><br><span class="line">                   grpc</span><br><span class="line">                   memcached</span><br><span class="line">                   websocket</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Look into module ngx_http_upstream_module</strong></li>
</ul>
<p>The ngx_http_upstream_module module is used to define groups of servers that can be referenced by the <code>proxy_pass</code>, <code>fastcgi_pass</code>, <code>uwsgi_pass</code>, <code>scgi_pass</code>, <code>memcached_pass</code>, and <code>grpc_pass directives</code>.</p>
<p>By default, the nginx is compiled with <code>http_upstream_module</code> . If we don’t want that, we need to use <code>--without-http_upstream_module</code>.</p>
<p>Let us look at directives</p>
<ol>
<li><code>upstream</code></li>
</ol>
<p><code>upstream name { ... }</code><br>Defines a group of servers in a block. Servers can listen on different ports. In addition, servers listening on TCP and UNIX-domain sockets can be mixed.<br>Context:    http<br>Here is the example:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    server backend1.example.com weight&#x3D;5;</span><br><span class="line">    server 127.0.0.1:8080       max_fails&#x3D;3 fail_timeout&#x3D;30s;</span><br><span class="line">    server unix:&#x2F;tmp&#x2F;backend3;</span><br><span class="line"></span><br><span class="line">    server backup1.example.com  backup;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ol>
<li><code>server</code></li>
</ol>
<p><code>server address [parameters];</code><br>Defines the address and other parameters of a server. The address can be specified as a domain name or IP address, with an optional port, or as a UNIX-domain socket path specified after the “unix:” prefix. If a port is not specified, the port 80 is used. A domain name that resolves to several IP addresses defines multiple servers at once.<br>Context:    upstream</p>
<p>Here is the parameters</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>parameter</th>
<th>detail</th>
</tr>
</thead>
<tbody>
<tr>
<td>weight=number</td>
<td>sets the weight of the server, by default, 1. The weight is larger, the nginx will giver more requests to the server</td>
</tr>
<tr>
<td>max_conns=number</td>
<td>limits the maximum number of simultaneous active connections to the proxied server.Default value is zero, meaning there is no limit. If the server group does not reside in the shared memory, the limitation works per each worker process.</td>
</tr>
<tr>
<td>max_fails=number</td>
<td>sets the number of unsuccessful attempts to communicate with the server that should happen in the duration set by the fail_timeout parameter to consider the server unavailable for a duration also set by the fail_timeout parameter.</td>
</tr>
<tr>
<td>fail_timeout=time</td>
<td>the time during which the specified number of unsuccessful attempts to communicate with the server should happen to consider the server unavailable; and the period of time the server will be considered unavailable.</td>
</tr>
</tbody>
</table>
</div>
<p>By default, the parameter is set to 10 seconds|<br>|backup|marks the server as a backup server. It will be passed requests when the primary servers are unavailable.|<br>|down|marks the server as a backup server. It will be passed requests when the primary servers are unavailable.|<br>|resolve|monitors changes of the IP addresses that correspond to a domain name of the server, and automatically modifies the upstream configuration without the need of restarting nginx (1.5.12). The server group must reside in the shared memory. In order for this parameter to work, the resolver directive must be specified in the http block or in the corresponding upstream block.|<br>|route=string|sets the server route name.|<br>|service=name|enables resolving of DNS SRV records and sets the service name (1.9.13). In order for this parameter to work, it is necessary to specify the resolve parameter for the server and specify a hostname without a port number.|<br>|slow_start=time|sets the time during which the server will recover its weight from zero to a nominal value, when unhealthy server becomes healthy, or when the server becomes available after a period of time it was considered unavailable. Default value is zero, i.e. slow start is disabled.|<br>|drain|puts the server into the “draining” mode (1.13.6). In this mode, only requests bound to the server will be proxied to it.|</p>
<ol>
<li><code>zone</code></li>
</ol>
<p><code>zone name [size];</code><br>Defines the name and size of the shared memory zone that keeps the group’s configuration and run-time state that are shared between worker processes. Several groups may share the same zone. In this case, it is enough to specify the size only once.<br>Context:    upstream</p>
<ol>
<li><code>keepalive</code></li>
</ol>
<p><code>keepalive connections;</code><br>The connections parameter sets the maximum number of idle keepalive connections to upstream servers that are preserved in the cache of each worker process. When this number is exceeded, the least recently used connections are closed.<br>Context:    upstream<br>For example:<br><code>keepalive 32</code></p>
<ol>
<li><code>keepalive_requests</code></li>
</ol>
<p><code>keepalive_requests number</code><br>Sets the maximum number of requests that can be served through one keepalive connection. After the maximum number of requests is made, the connection is closed.<br>Default:    <code>keepalive_requests 1000;</code><br>Context:    upstream</p>
<ol>
<li><code>keepalive_timeout</code></li>
</ol>
<p><code>keepalive_timeout timeout;</code><br>Sets a timeout during which an idle keepalive connection to an upstream server will stay open.<br>Default:    <code>keepalive_timeout 60s;</code><br>Context:    upstream</p>
<p>And some other directives are related to load balance.<br><code>hash</code>,<code>ip_hash</code>,<code>least_conn</code>,<code>least_time</code>,<code>random</code>.  We will talk about it later.</p>
<ol>
<li><code>queue</code>[in commercial version only ]</li>
</ol>
<p><code>queue number [timeout=time];</code><br>If an upstream server cannot be selected immediately while processing a request, the request will be placed into the queue. The directive specifies the maximum number of requests that can be in the queue at the same time.<br>Context:    upstream<br>For example:<br><code>queue 100 timeout =30s</code></p>
<ul>
<li><strong>Look into proxy_pass directive</strong></li>
</ul>
<p><code>proxy_pass</code> is in <code>ngx_http_proxy_module</code> module<br>The ngx_http_proxy_module module allows passing requests to another server.<br>By default, it is compiled with <code>ngx_http_proxy_module</code>.If we don’t want to use the module <code>--without-ngx_http_proxy_module</code></p>
<p><code>proxy_pass URL;</code><br>Context:    location, if in location, limit_except<br>Sets the protocol and address of a proxied server and an optional URI to which a location should be mapped. As a protocol, “http” or “https” can be specified. The address can be specified as a domain name or IP address, and an optional port:</p>
<p><code>proxy_pass http://localhost:8000/uri/;</code><br>or as a UNIX-domain socket path specified after the word “unix” and enclosed in colons:</p>
<p><code>proxy_pass http://unix:/tmp/backend.socket:/uri/;</code><br>If a domain name resolves to several addresses, all of them will be used in a round-robin fashion. In addition, an address can be specified as a server group.</p>
<p>Let us look at the difference between URL ends with <code>/</code> and without <code>/</code></p>
<p>If the url ends without <code>/</code>,nginx will modify the url by deleting the location url in proxy url.<br>If the url ends without <code>/</code>,nginx will not modify the URL and directly send it to upstream server.</p>
<p>For example,<br>if users use url <code>bbs/abc/test.html</code>,<br>if the config file is<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location &#x2F;bbs&#x2F;&#123;</span><br><span class="line">  proxy_pass http:&#x2F;&#x2F;127.0.0.1:8000</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>the url arrive at upstream server will be <code>bbs/abc/test.html</code>.</p>
<p>if the config file is<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location &#x2F;bbs&#x2F;&#123;</span><br><span class="line">  proxy_pass http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>the url arrive at upstream server will be <code>abc/test.html</code>.</p>
<ul>
<li><strong>An example of reverse proxy by nginx</strong></li>
</ul>
<p>I don’t want to directly change the <code>nginx.conf</code> every time.  let us introduce a directive <code>include</code></p>
<p><code>include file | mask;</code><br>Includes another file, or files matching the specified mask, into configuration. Included files should consist of syntactically correct directives and blocks.<br>Context:    any</p>
<p>So to create a  new server block, we just need a include directive in <code>nginx.conf</code> like <code>include servers/*.conf;</code>. So every time we want to create a new server, we only need to create a file in servers.</p>
<p>create a file named <code>proxy.conf</code> in server folder</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    # the server can provide function</span><br><span class="line">    server 127.0.0.1:8000;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen 8081;</span><br><span class="line">    server_name localhost;</span><br><span class="line">    location &#x2F;helloworld &#123;</span><br><span class="line">      proxy_pass http:&#x2F;&#x2F;backend&#x2F;v1&#x2F;users&#x2F;helloworld;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Notice: we may need to add backend to allow_hosts in django(since the url is provided by django). Or we will face error <code>Invalid HTTP_HOST header: &#39;backend&#39;</code></p>
<p>Then we could visit <code>localhost:8081/helloworld</code></p>
<ul>
<li><strong>Some directives related to proxy</strong></li>
</ul>
<ol>
<li><code>proxy_request_buffering</code></li>
</ol>
<p><code>proxy_request_buffering on | off;</code><br>Enables or disables buffering of a client request body.</p>
<p>When buffering is enabled, the entire request body is read from the client before sending the request to a proxied server. It meets  the high throughput requirements and it is suitable when the concurrent processing capability of upstream services is low</p>
<p>When buffering is disabled, the request body is sent to the proxied server immediately as it is received. In this case, the request cannot be passed to the next server if nginx already started sending the request body. It will reduce the responses time and save disk space.</p>
<p>When HTTP/1.1 chunked transfer encoding is used to send the original request body, the request body will be buffered regardless of the directive value unless HTTP/1.1 is enabled for proxying.<br>Default:    <code>proxy_request_buffering on;</code><br>Context:    http, server, location</p>
<ol>
<li><code>client_max_body_size</code></li>
</ol>
<p><code>client_max_body_size size;</code><br>Sets the maximum allowed size of the client request body. If the size in a request exceeds the configured value, the 413 (Request Entity Too Large) error is returned to the client. Please be aware that browsers cannot correctly display this error. Setting size to 0 disables checking of client request body size.<br>Default:    <code>client_max_body_size 1m;</code><br>Context:    http, server, location</p>
<ol>
<li><code>client_body_buffer_size</code></li>
</ol>
<p><code>client_body_buffer_size size;</code><br>Sets buffer size for reading client request body. In case the request body is larger than the buffer, the whole body or only its part is written to a temporary file(defined by <code>client_body_temp_path</code>). By default, buffer size is equal to two memory pages. This is 8K on x86, other 32-bit platforms, and x86-64. It is usually 16K on other 64-bit platforms.</p>
<p>Default:    <code>client_body_buffer_size 8k|16k;</code><br>Context:    http, server, location</p>
<ol>
<li><code>client_body_temp_path</code></li>
</ol>
<p><code>client_body_temp_path path [level1 [level2 [level3]]]</code>;<br>Default:    <code>client_body_temp_path client_body_temp;</code><br>Context:    http, server, location<br>Defines a directory for storing temporary files holding client request bodies. Up to three-level subdirectory hierarchy can be used under the specified directory. For example, in the following configuration</p>
<p><code>client_body_temp_path /spool/nginx/client_temp 1 2;</code></p>
<p>a path to a temporary file might look like this:</p>
<p><code>/spool/nginx/client_temp/7/45/00000123457</code></p>
<p>Here, if there are values ​​for level1,2,3, it means that there are subdirectories at level 1, level 2, and level 3.<br>Directory names are named by numbers, so the specific value here is the number of digits representing the directory name</p>
<ol>
<li><code>client_body_in_single_buffer</code></li>
</ol>
<p><code>client_body_in_single_buffer on | off;</code><br>Determines whether nginx should save the entire client request body in a single buffer. The directive is recommended when using the $request_body variable, to save the number of copy operations involved.<br>Default:    <code>client_body_in_single_buffer off;</code><br>Context:    http, server, location</p>
<ol>
<li><code>client_body_in_file_only</code></li>
</ol>
<p><code>client_body_in_file_only on | clean | off;</code></p>
<p>Determines whether nginx should save the entire client request body into a file. This directive can be used during debugging, or when using the <code>$request_body_file</code> variable, or the <code>$r-&gt;request_body_file</code> method of the module ngx_http_perl_module.<br>When set to the value on, temporary files are not removed after request processing.<br>The value clean will cause the temporary files left after request processing to be removed.</p>
<p>Default:    <code>client_body_in_file_only off;</code><br>Context:    http, server, location</p>
<ol>
<li><code>client_body_timeout</code></li>
</ol>
<p><code>client_body_timeout time;</code><br>Default:    <code>client_body_timeout 60s;</code><br>Context:    http, server, location<br>Defines a timeout for reading client request body. The timeout is set only for a period between two successive read operations, not for the transmission of the whole request body. If a client does not transmit anything within this time, the request is terminated with the 408 (Request Time-out) error.</p>
<ul>
<li><strong>How does nginx change the request message sent upstream server when we use nginx for revese proxy</strong></li>
</ul>
<p>Look at some directives may work</p>
<ol>
<li><code>proxy_method</code></li>
</ol>
<p><code>proxy_method method;</code><br>Specifies the HTTP method to use in requests forwarded to the proxied server instead of the method from the client request. Parameter value can contain variables (1.11.6).<br>Context:    http, server, location</p>
<ol>
<li><code>proxy_http_version</code></li>
</ol>
<p><code>proxy_http_version 1.0 | 1.1;</code><br>Sets the HTTP protocol version for proxying. By default, version 1.0 is used. Version 1.1 is recommended for use with keepalive connections and NTLM authentication.<br>Default:    <code>proxy_http_version 1.0;</code><br>Context:    http, server, location</p>
<ol>
<li><code>proxy_set_header</code></li>
</ol>
<p><code>proxy_set_header field value;</code><br>Allows redefining or appending fields to the request header passed to the proxied server.<br>Default:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">proxy_set_header Host $proxy_host;&#96;</span><br><span class="line">proxy_set_header Connection close;</span><br></pre></td></tr></table></figure><br>Context:    http, server, location</p>
<ol>
<li><code>proxy_pass_request_headers</code></li>
</ol>
<p><code>proxy_pass_request_headers on | off;</code><br>Indicates whether the header fields of the original request are passed to the proxied server.<br>Default:    <code>proxy_pass_request_headers on;</code><br>Context:    http, server, location</p>
<ol>
<li><code>proxy_set_body</code></li>
</ol>
<p><code>proxy_set_body value;</code><br>Allows redefining the request body passed to the proxied server. The value can contain text, variables, and their combination.<br>Context:    http, server, location</p>
<ol>
<li><code>proxy_pass_request_body</code></li>
</ol>
<p><code>proxy_pass_request_body on | off;</code><br>Default:    <code>proxy_pass_request_body on;</code><br>Context:    http, server, location<br>Indicates whether the original request body is passed to the proxied server.</p>
<ul>
<li><strong>Details of establishing a connection between Nginx and upstream server in a proxy scenario</strong></li>
</ul>
<p>Let we look at some directives</p>
<ol>
<li><code>proxy_connect_timeout</code></li>
</ol>
<p><code>proxy_connect_timeout time;</code><br>Defines a timeout for establishing a connection with a proxied server. It should be noted that this timeout cannot usually exceed 75 seconds<br>Default:    <code>proxy_connect_timeout 60s;</code><br>Context:    http, server, location</p>
<ol>
<li><code>proxy_socket_keepalive</code></li>
</ol>
<p><code>proxy_socket_keepalive on | off;</code><br>Configures the “TCP keepalive” behavior for outgoing connections to a proxied server. By default, the operating system’s settings are in effect for the socket. If the directive is set to the value “on”, the SO_KEEPALIVE socket option is turned on for the socket.<br>Default:    <code>proxy_socket_keepalive off;</code><br>Context:    http, server, location</p>
<p>Note: there is a difference between HTTP KEEP-ALIVE and TCP KEEPALIVE.<br><a href="https://www.jianshu.com/p/cd71efa49d63">https://www.jianshu.com/p/cd71efa49d63</a></p>
<ol>
<li><code>proxy_send_timeout</code></li>
</ol>
<p><code>proxy_send_timeout time;</code><br>Sets a timeout for transmitting a request to the proxied server. The timeout is set only between two successive write operations, not for the transmission of the whole request. If the proxied server does not receive anything within this time, the connection is closed.<br>Default:    <code>proxy_send_timeout 60s;</code><br>Context:    http, server, location</p>
<ol>
<li><code>proxy_ignore_client_abort on | off;</code></li>
</ol>
<p><code>proxy_ignore_client_abort on | off;</code><br>Default:    <code>proxy_ignore_client_abort off;</code><br>Determines whether the connection with a proxied server should be closed when a client closes the connection without waiting for a response.<br>Context:    http, server, location</p>
<ul>
<li><strong>reference</strong><br><a href="https://nginx.org/en/docs/dirindex.html">https://nginx.org/en/docs/dirindex.html</a></li>
</ul>
</div><div class="article-tags size-small is-uppercase mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/nginx/">nginx</a><a class="link-muted mr-2" rel="tag" href="/tags/learning-note/">learning note</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2021/09/15/notes-of-nginx-learning-11/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">notes of nginx learning (11)</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2021/09/15/notes-of-nginx-learning-9/"><span class="level-item">notes of nginx learning (9)</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="is-rounded" src="/img/avatar.jpeg" alt="koko"></figure><p class="title is-size-4 is-block line-height-inherit">koko</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Troy, NY</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">48</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">3</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">34</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/lawiet019" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/lawiet019"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/math/"><span class="level-start"><span class="level-item">math</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/technology/"><span class="level-start"><span class="level-item">technology</span></span><span class="level-end"><span class="level-item tag">41</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/technology/math/"><span class="level-start"><span class="level-item">math</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li></ul></div></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">Recent</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2022-04-10T02:39:00.000Z">2022-04-09</time></p><p class="title is-6"><a class="link-muted" href="/2022/04/09/Authentication-vs-Authorization-md/">Authentication_vs_Authorization.md</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/technology/">technology</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2022-03-12T16:16:00.000Z">2022-03-12</time></p><p class="title is-6"><a class="link-muted" href="/2022/03/12/problems-faced-when-using-unittest-mock/">problems faced when using unittest.mock</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/technology/">technology</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2022-02-28T21:56:00.000Z">2022-02-28</time></p><p class="title is-6"><a class="link-muted" href="/2022/02/28/nil-in-golang/">nil in golang</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/technology/">technology</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2022-02-28T21:54:00.000Z">2022-02-28</time></p><p class="title is-6"><a class="link-muted" href="/2022/02/28/Perforce-note-2/">Perforce note (2)</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/technology/">technology</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2022-02-26T14:42:00.000Z">2022-02-26</time></p><p class="title is-6"><a class="link-muted" href="/2022/02/26/Perforce-notes-1/">Perforce notes (1)</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/technology/">technology</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2022/04/"><span class="level-start"><span class="level-item">April 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2022/03/"><span class="level-start"><span class="level-item">March 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2022/02/"><span class="level-start"><span class="level-item">February 2022</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/12/"><span class="level-start"><span class="level-item">December 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/11/"><span class="level-start"><span class="level-item">November 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/09/"><span class="level-start"><span class="level-item">September 2021</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/08/"><span class="level-start"><span class="level-item">August 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/05/"><span class="level-start"><span class="level-item">May 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/12/"><span class="level-start"><span class="level-item">December 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/11/"><span class="level-start"><span class="level-item">November 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/10/"><span class="level-start"><span class="level-item">October 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/08/"><span class="level-start"><span class="level-item">August 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/07/"><span class="level-start"><span class="level-item">July 2020</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/06/"><span class="level-start"><span class="level-item">June 2020</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/05/"><span class="level-start"><span class="level-item">May 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/C/"><span class="tag">C++</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Graph/"><span class="tag">Graph</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/algorithm/"><span class="tag">algorithm</span><span class="tag is-grey-lightest">12</span></a></div><div class="control"><a class="tags has-addons" href="/tags/binary-search/"><span class="tag">binary search</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bit-manipulation/"><span class="tag">bit manipulation</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/blueprint/"><span class="tag">blueprint</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/collections/"><span class="tag">collections</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/computing/"><span class="tag">computing</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cookit/"><span class="tag">cookit</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/debug/"><span class="tag">debug</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dependency-injection/"><span class="tag">dependency injection</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dynamic-programming/"><span class="tag">dynamic programming</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flask/"><span class="tag">flask</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/go/"><span class="tag">go</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/golang/"><span class="tag">golang</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/graph/"><span class="tag">graph</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hexo/"><span class="tag">hexo</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/learning-note/"><span class="tag">learning note</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/linked-list/"><span class="tag">linked list</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mock/"><span class="tag">mock</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/multiprocess/"><span class="tag">multiprocess</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/multithread/"><span class="tag">multithread</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/network/"><span class="tag">network</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nginx/"><span class="tag">nginx</span><span class="tag is-grey-lightest">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/perforce/"><span class="tag">perforce</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/python/"><span class="tag">python</span><span class="tag is-grey-lightest">24</span></a></div><div class="control"><a class="tags has-addons" href="/tags/regular-expression/"><span class="tag">regular expression</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/session/"><span class="tag">session</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sort/"><span class="tag">sort</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sorting/"><span class="tag">sorting</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/token/"><span class="tag">token</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tool/"><span class="tag">tool</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tree/"><span class="tag">tree</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/unittest/"><span class="tag">unittest</span><span class="tag is-grey-lightest">1</span></a></div></div></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe to Updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="Subscribe"></div></div></form></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/favicon.png" alt="lawilet&#039;s website" height="28"></a><p class="size-small"><span>&copy; 2022 lawiet019</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'http://law-liet.com',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to Top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>